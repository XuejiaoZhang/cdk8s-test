"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const sinon = require("sinon");
const lib_1 = require("../lib");
const docker_1 = require("../lib/docker");
const os = require("../lib/os");
const mock_sdk_1 = require("./util/mock-sdk");
const shellFake = async (args) => {
    if (args[1] === 'login') {
        return 'LOGIN';
    }
    if (args[1] === 'build') {
        throw new Error('STOPTEST');
    }
    throw new Error('UNEXPECTED');
};
test('fails if "repositoryName" and "imageTag" are not specified', async () => {
    // GIVEN
    const toolkit = newMockToolkitInfo();
    // WHEN
    const asset = {
        id: 'assetId',
        packaging: 'container-image',
        path: '/foo',
        sourceHash: '0123456789abcdef',
    };
    // THEN
    await expect(docker_1.prepareContainerAsset('.', asset, toolkit, false))
        .rejects.toEqual(new Error(`invalid docker image asset configuration\. "repositoryName" and "imageTag" are required and "imageNameParameter" is not allowed`));
});
test('fails if "repositoryName" is not specified', async () => {
    // GIVEN
    const toolkit = newMockToolkitInfo();
    // WHEN
    const asset = {
        id: 'assetId',
        repositoryName: 'repository-name',
        packaging: 'container-image',
        path: '/foo',
        sourceHash: '0123456789abcdef',
    };
    // THEN
    await expect(docker_1.prepareContainerAsset('.', asset, toolkit, false))
        .rejects.toEqual(new Error(`invalid docker image asset configuration\. "repositoryName" and "imageTag" are required and "imageNameParameter" is not allowed`));
});
test('creates repository with given name', async () => {
    // GIVEN
    const sdk = new mock_sdk_1.MockSDK();
    const toolkit = newMockToolkitInfo(sdk);
    let createdName;
    sdk.stubEcr({
        describeRepositories: () => ({ repositories: [] }),
        createRepository: req => {
            createdName = req.repositoryName;
            // Stop the test so that we don't actually docker build
            throw new Error('STOPTEST');
        },
    });
    // WHEN
    const asset = {
        id: 'assetId',
        packaging: 'container-image',
        path: '/foo',
        repositoryName: 'some-name',
        imageTag: 'image-tag',
        sourceHash: '0123456789abcdef',
    };
    try {
        await docker_1.prepareContainerAsset('.', asset, toolkit, false);
    }
    catch (e) {
        if (!/STOPTEST/.test(e.toString())) {
            throw e;
        }
    }
    // THEN
    expect(createdName).toBe('some-name');
});
test('configures image scanning', async () => {
    // GIVEN
    let putImageScanningConfigurationParams;
    const sdk = new mock_sdk_1.MockSDK();
    sdk.stubEcr({
        describeRepositories: () => ({ repositories: [] }),
        createRepository: () => ({ repository: { repositoryUri: 'uri' } }),
        putImageScanningConfiguration: params => {
            putImageScanningConfigurationParams = params;
            // Stop the test so that we don't actually docker build
            throw new Error('STOPTEST');
        }
    });
    const toolkit = newMockToolkitInfo(sdk);
    // WHEN
    const asset = {
        id: 'assetId',
        packaging: 'container-image',
        path: '/foo',
        repositoryName: 'some-name',
        imageTag: 'some-tag',
        sourceHash: '0123456789abcdef',
    };
    try {
        await docker_1.prepareContainerAsset('.', asset, toolkit, false);
    }
    catch (e) {
        if (!/STOPTEST/.test(e.toString())) {
            throw e;
        }
    }
    expect(putImageScanningConfigurationParams).toEqual({
        repositoryName: 'some-name',
        imageScanningConfiguration: {
            scanOnPush: true
        }
    });
});
test('calls docker login with the corrects args and before docker build', async () => {
    // GIVEN
    const toolkit = newMockToolkitInfo();
    const prepareEcrRepositoryStub = sinon.stub(toolkit, 'prepareEcrRepository').resolves({ repositoryUri: 'uri' });
    const checkEcrImageStub = sinon.stub(toolkit, 'checkEcrImage').resolves(false);
    const shellStub = sinon.stub(os, 'shell').callsFake(shellFake);
    const getEcrCredentialsStub = sinon.stub(toolkit, 'getEcrCredentials').resolves({
        username: 'username',
        password: 'password',
        endpoint: 'endpoint'
    });
    // WHEN
    const asset = {
        id: 'assetId',
        packaging: 'container-image',
        path: '/foo',
        sourceHash: '1234567890abcdef',
        repositoryName: 'some-name',
        imageTag: 'some-tag',
        buildArgs: {
            a: 'b',
            c: 'd'
        },
        target: 'a-target',
    };
    try {
        await docker_1.prepareContainerAsset('.', asset, toolkit, false);
    }
    catch (e) {
        if (!/STOPTEST/.test(e.toString())) {
            throw e;
        }
    }
    // THEN
    const command = ['docker', 'login', '--username', 'username', '--password', 'password', 'endpoint'];
    sinon.assert.calledWith(shellStub.firstCall, command);
    prepareEcrRepositoryStub.restore();
    shellStub.restore();
    checkEcrImageStub.restore();
    getEcrCredentialsStub.restore();
});
test('passes the correct target to docker build', async () => {
    // GIVEN
    const toolkit = newMockToolkitInfo();
    const prepareEcrRepositoryStub = sinon.stub(toolkit, 'prepareEcrRepository').resolves({ repositoryUri: 'uri' });
    const checkEcrImageStub = sinon.stub(toolkit, 'checkEcrImage').resolves(false);
    const shellStub = sinon.stub(os, 'shell').callsFake(shellFake);
    const getEcrCredentialsStub = sinon.stub(toolkit, 'getEcrCredentials').resolves({
        username: 'username',
        password: 'password',
        endpoint: 'endpoint'
    });
    // WHEN
    const asset = {
        id: 'assetId',
        packaging: 'container-image',
        path: '/foo',
        sourceHash: '1234567890abcdef',
        repositoryName: 'some-name',
        imageTag: 'some-tag',
        buildArgs: {
            a: 'b',
            c: 'd'
        },
        target: 'a-target',
    };
    try {
        await docker_1.prepareContainerAsset('.', asset, toolkit, false);
    }
    catch (e) {
        if (!/STOPTEST/.test(e.toString())) {
            throw e;
        }
    }
    // THEN
    const command = ['docker', 'build', '--tag', `uri:some-tag`, '--target', 'a-target', '--build-arg', 'a=b', '--build-arg', 'c=d', '/foo'];
    sinon.assert.calledWith(shellStub, command);
    prepareEcrRepositoryStub.restore();
    shellStub.restore();
    checkEcrImageStub.restore();
    getEcrCredentialsStub.restore();
});
test('passes the correct args to docker build', async () => {
    // GIVEN
    const toolkit = newMockToolkitInfo();
    const prepareEcrRepositoryStub = sinon.stub(toolkit, 'prepareEcrRepository').resolves({ repositoryUri: 'uri' });
    const checkEcrImageStub = sinon.stub(toolkit, 'checkEcrImage').resolves(false);
    const shellStub = sinon.stub(os, 'shell').callsFake(shellFake);
    const getEcrCredentialsStub = sinon.stub(toolkit, 'getEcrCredentials').resolves({
        username: 'username',
        password: 'password',
        endpoint: 'endpoint'
    });
    // WHEN
    const asset = {
        id: 'assetId',
        packaging: 'container-image',
        path: '/foo',
        sourceHash: '1234567890abcdef',
        repositoryName: 'some-name',
        imageTag: 'some-tag',
        buildArgs: {
            a: 'b',
            c: 'd'
        }
    };
    try {
        await docker_1.prepareContainerAsset('.', asset, toolkit, false);
    }
    catch (e) {
        if (!/STOPTEST/.test(e.toString())) {
            throw e;
        }
    }
    // THEN
    const command = ['docker', 'build', '--tag', `uri:some-tag`, '--build-arg', 'a=b', '--build-arg', 'c=d', '/foo'];
    sinon.assert.calledWith(shellStub, command);
    prepareEcrRepositoryStub.restore();
    checkEcrImageStub.restore();
    shellStub.restore();
    getEcrCredentialsStub.restore();
});
test('passes the correct docker file name if specified', async () => {
    const toolkit = newMockToolkitInfo();
    const prepareEcrRepositoryStub = sinon.stub(toolkit, 'prepareEcrRepository').resolves({ repositoryUri: 'uri' });
    const checkEcrImageStub = sinon.stub(toolkit, 'checkEcrImage').resolves(false);
    const shellStub = sinon.stub(os, 'shell').callsFake(shellFake);
    const getEcrCredentialsStub = sinon.stub(toolkit, 'getEcrCredentials').resolves({
        username: 'username',
        password: 'password',
        endpoint: 'endpoint'
    });
    // WHEN
    const asset = {
        id: 'assetId',
        packaging: 'container-image',
        path: '/foo',
        sourceHash: '1234567890abcdef',
        repositoryName: 'some-name',
        imageTag: 'some-tag',
        file: 'CustomDockerfile',
        buildArgs: {
            a: 'b',
            c: 'd'
        }
    };
    try {
        await docker_1.prepareContainerAsset('.', asset, toolkit, false);
    }
    catch (e) {
        if (!/STOPTEST/.test(e.toString())) {
            throw e;
        }
    }
    // THEN
    const command = ['docker', 'build', '--tag', `uri:some-tag`, '--file', '/foo/CustomDockerfile', '--build-arg', 'a=b', '--build-arg', 'c=d', '/foo'];
    sinon.assert.calledWith(shellStub, command);
    prepareEcrRepositoryStub.restore();
    checkEcrImageStub.restore();
    shellStub.restore();
    getEcrCredentialsStub.restore();
});
test('relative path', async () => {
    // GIVEN
    const toolkit = newMockToolkitInfo();
    const prepareEcrRepositoryStub = sinon.stub(toolkit, 'prepareEcrRepository').resolves({ repositoryUri: 'uri' });
    const checkEcrImageStub = sinon.stub(toolkit, 'checkEcrImage').resolves(false);
    const shellStub = sinon.stub(os, 'shell').callsFake(shellFake);
    const getEcrCredentialsStub = sinon.stub(toolkit, 'getEcrCredentials').resolves({
        username: 'username',
        password: 'password',
        endpoint: 'endpoint'
    });
    // WHEN
    const asset = {
        id: 'assetId',
        packaging: 'container-image',
        path: 'relative-to-assembly',
        sourceHash: '1234567890abcdef',
        repositoryName: 'some-name',
        imageTag: 'some-tag',
        buildArgs: {
            a: 'b',
            c: 'd'
        }
    };
    try {
        await docker_1.prepareContainerAsset('/assembly/dir/root', asset, toolkit, false);
    }
    catch (e) {
        if (!/STOPTEST/.test(e.toString())) {
            throw e;
        }
    }
    // THEN
    const command = ['docker', 'build', '--tag', `uri:some-tag`, '--build-arg', 'a=b', '--build-arg', 'c=d', '/assembly/dir/root/relative-to-assembly'];
    sinon.assert.calledWith(shellStub, command);
    prepareEcrRepositoryStub.restore();
    checkEcrImageStub.restore();
    shellStub.restore();
    getEcrCredentialsStub.restore();
});
test('skips build & push if image already exists in the ECR repo', async () => {
    // GIVEN
    const toolkit = newMockToolkitInfo();
    const prepareEcrRepositoryStub = sinon.stub(toolkit, 'prepareEcrRepository');
    const shellStub = sinon.stub(os, 'shell');
    const checkEcrImageStub = sinon.stub(toolkit, 'checkEcrImage').resolves(true);
    // WHEN
    const asset = {
        id: 'assetId',
        packaging: 'container-image',
        path: 'relative-to-assembly',
        sourceHash: '1234567890abcdef',
        repositoryName: 'some-name',
        imageTag: 'some-tag',
        buildArgs: {
            a: 'b',
            c: 'd'
        }
    };
    await docker_1.prepareContainerAsset('/assembly/dir/root', asset, toolkit, false);
    // THEN
    sinon.assert.calledOnce(prepareEcrRepositoryStub);
    sinon.assert.calledOnce(checkEcrImageStub);
    sinon.assert.notCalled(shellStub);
});
function newMockToolkitInfo(sdk = new mock_sdk_1.MockSDK()) {
    return new lib_1.ToolkitInfo({
        sdk,
        bucketName: 'BUCKET_NAME',
        bucketEndpoint: 'BUCKET_ENDPOINT',
        environment: { name: 'env', account: '1234', region: 'abc' }
    });
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZG9ja2VyLW5ldy50ZXN0LmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiZG9ja2VyLW5ldy50ZXN0LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7O0FBQ0EsK0JBQStCO0FBQy9CLGdDQUFxQztBQUNyQywwQ0FBc0Q7QUFDdEQsZ0NBQWdDO0FBQ2hDLDhDQUEwQztBQUUxQyxNQUFNLFNBQVMsR0FBRyxLQUFLLEVBQUUsSUFBYyxFQUFFLEVBQUU7SUFDekMsSUFBSSxJQUFJLENBQUMsQ0FBQyxDQUFDLEtBQUssT0FBTyxFQUFFO1FBQ3ZCLE9BQU8sT0FBTyxDQUFDO0tBQ2hCO0lBRUQsSUFBSSxJQUFJLENBQUMsQ0FBQyxDQUFDLEtBQUssT0FBTyxFQUFFO1FBQ3ZCLE1BQU0sSUFBSSxLQUFLLENBQUMsVUFBVSxDQUFDLENBQUM7S0FDN0I7SUFFRCxNQUFNLElBQUksS0FBSyxDQUFDLFlBQVksQ0FBQyxDQUFDO0FBQ2hDLENBQUMsQ0FBQztBQUVGLElBQUksQ0FBQyw0REFBNEQsRUFBRSxLQUFLLElBQUksRUFBRTtJQUM1RSxRQUFRO0lBQ1IsTUFBTSxPQUFPLEdBQUcsa0JBQWtCLEVBQUUsQ0FBQztJQUVyQyxPQUFPO0lBQ1AsTUFBTSxLQUFLLEdBQTJDO1FBQ3BELEVBQUUsRUFBRSxTQUFTO1FBQ2IsU0FBUyxFQUFFLGlCQUFpQjtRQUM1QixJQUFJLEVBQUUsTUFBTTtRQUNaLFVBQVUsRUFBRSxrQkFBa0I7S0FDL0IsQ0FBQztJQUVGLE9BQU87SUFDUCxNQUFNLE1BQU0sQ0FBQyw4QkFBcUIsQ0FBQyxHQUFHLEVBQUUsS0FBSyxFQUFFLE9BQU8sRUFBRSxLQUFLLENBQUMsQ0FBQztTQUM1RCxPQUFPLENBQUMsT0FBTyxDQUFDLElBQUksS0FBSyxDQUFDLGlJQUFpSSxDQUFDLENBQUMsQ0FBQztBQUNuSyxDQUFDLENBQUMsQ0FBQztBQUVILElBQUksQ0FBQyw0Q0FBNEMsRUFBRSxLQUFLLElBQUksRUFBRTtJQUM1RCxRQUFRO0lBQ1IsTUFBTSxP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S0FBSyxFQUFFO0tBQzdELENBQUMsQ0FBQztBQUNMLENBQUMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgKiBhcyBjeGFwaSBmcm9tICdAYXdzLWNkay9jeC1hcGknO1xuaW1wb3J0ICogYXMgc2lub24gZnJvbSAnc2lub24nO1xuaW1wb3J0IHsgVG9vbGtpdEluZm8gfSBmcm9tICcuLi9saWInO1xuaW1wb3J0IHsgcHJlcGFyZUNvbnRhaW5lckFzc2V0IH0gZnJvbSAnLi4vbGliL2RvY2tlcic7XG5pbXBvcnQgKiBhcyBvcyBmcm9tICcuLi9saWIvb3MnO1xuaW1wb3J0IHsgTW9ja1NESyB9IGZyb20gJy4vdXRpbC9tb2NrLXNkayc7XG5cbmNvbnN0IHNoZWxsRmFrZSA9IGFzeW5jIChhcmdzOiBzdHJpbmdbXSkgPT4ge1xuICBpZiAoYXJnc1sxXSA9PT0gJ2xvZ2luJykge1xuICAgIHJldHVybiAnTE9HSU4nO1xuICB9XG5cbiAgaWYgKGFyZ3NbMV0gPT09ICdidWlsZCcpIHtcbiAgICB0aHJvdyBuZXcgRXJyb3IoJ1NUT1BURVNUJyk7XG4gIH1cblxuICB0aHJvdyBuZXcgRXJyb3IoJ1VORVhQRUNURUQnKTtcbn07XG5cbnRlc3QoJ2ZhaWxzIGlmIFwicmVwb3NpdG9yeU5hbWVcIiBhbmQgXCJpbWFnZVRhZ1wiIGFyZSBub3Qgc3BlY2lmaWVkJywgYXN5bmMgKCkgPT4ge1xuICAvLyBHSVZFTlxuICBjb25zdCB0b29sa2l0ID0gbmV3TW9ja1Rvb2xraXRJbmZvKCk7XG5cbiAgLy8gV0hFTlxuICBjb25zdCBhc3NldDogY3hhcGkuQ29udGFpbmVySW1hZ2VBc3NldE1ldGFkYXRhRW50cnkgPSB7XG4gICAgaWQ6ICdhc3NldElkJyxcbiAgICBwYWNrYWdpbmc6ICdjb250YWluZXItaW1hZ2UnLFxuICAgIHBhdGg6ICcvZm9vJyxcbiAgICBzb3VyY2VIYXNoOiAnMDEyMzQ1Njc4OWFiY2RlZicsXG4gIH07XG5cbiAgLy8gVEhFTlxuICBhd2FpdCBleHBlY3QocHJlcGFyZUNvbnRhaW5lckFzc2V0KCcuJywgYXNzZXQsIHRvb2xraXQsIGZhbHNlKSlcbiAgICAucmVqZWN0cy50b0VxdWFsKG5ldyBFcnJvcihgaW52YWxpZCBkb2NrZXIgaW1hZ2UgYXNzZXQgY29uZmlndXJhdGlvblxcLiBcInJlcG9zaXRvcnlOYW1lXCIgYW5kIFwiaW1hZ2VUYWdcIiBhcmUgcmVxdWlyZWQgYW5kIFwiaW1hZ2VOYW1lUGFyYW1ldGVyXCIgaXMgbm90IGFsbG93ZWRgKSk7XG59KTtcblxudGVzdCgnZmFpbHMgaWYgXCJyZXBvc2l0b3J5TmFtZVwiIGlzIG5vdCBzcGVjaWZpZWQnLCBhc3luYyAoKSA9PiB7XG4gIC8vIEdJVkVOXG4gIGNvbnN0IHRvb2xraXQgPSBuZXdNb2NrVG9vbGtpdEluZm8oKTtcblxuICAvLyBXSEVOXG4gIGNvbnN0IGFzc2V0OiBjeGFwaS5Db250YWluZXJJbWFnZUFzc2V0TWV0YWRhdGFFbnRyeSA9IHtcbiAgICBpZDogJ2Fzc2V0SWQnLFxuICAgIHJlcG9zaXRvcnlOYW1lOiAncmVwb3NpdG9yeS1uYW1lJyxcbiAgICBwYWNrYWdpbmc6ICdjb250YWluZXItaW1hZ2UnLFxuICAgIHBhdGg6ICcvZm9vJyxcbiAgICBzb3VyY2VIYXNoOiAnMDEyMzQ1Njc4OWFiY2RlZicsXG4gIH07XG5cbiAgLy8gVEhFTlxuICBhd2FpdCBleHBlY3QocHJlcGFyZUNvbnRhaW5lckFzc2V0KCcuJywgYXNzZXQsIHRvb2xraXQsIGZhbHNlKSlcbiAgICAucmVqZWN0cy50b0VxdWFsKG5ldyBFcnJvcihgaW52YWxpZCBkb2NrZXIgaW1hZ2UgYXNzZXQgY29uZmlndXJhdGlvblxcLiBcInJlcG9zaXRvcnlOYW1lXCIgYW5kIFwiaW1hZ2VUYWdcIiBhcmUgcmVxdWlyZWQgYW5kIFwiaW1hZ2VOYW1lUGFyYW1ldGVyXCIgaXMgbm90IGFsbG93ZWRgKSk7XG59KTtcblxudGVzdCgnY3JlYXRlcyByZXBvc2l0b3J5IHdpdGggZ2l2ZW4gbmFtZScsIGFzeW5jICgpID0+IHtcbiAgLy8gR0lWRU5cbiAgY29uc3Qgc2RrID0gbmV3IE1vY2tTREsoKTtcbiAgY29uc3QgdG9vbGtpdCA9IG5ld01vY2tUb29sa2l0SW5mbyhzZGspO1xuICBsZXQgY3JlYXRlZE5hbWU7XG5cbiAgc2RrLnN0dWJFY3Ioe1xuICAgIGRlc2NyaWJlUmVwb3NpdG9yaWVzOiAoKSA9PiAoeyByZXBvc2l0b3JpZXM6IFtdIH0pLFxuICAgIGNyZWF0ZVJlcG9zaXRvcnk6IHJlcSA9PiB7XG4gICAgICBjcmVhdGVkTmFtZSA9IHJlcS5yZXBvc2l0b3J5TmFtZTtcblxuICAgICAgLy8gU3RvcCB0aGUgdGVzdCBzbyB0aGF0IHdlIGRvbid0IGFjdHVhbGx5IGRvY2tlciBidWlsZFxuICAgICAgdGhyb3cgbmV3IEVycm9yKCdTVE9QVEVTVCcpO1xuICAgIH0sXG4gIH0pO1xuXG4gIC8vIFdIRU5cbiAgY29uc3QgYXNzZXQ6IGN4YXBpLkNvbnRhaW5lckltYWdlQXNzZXRNZXRhZGF0YUVudHJ5ID0ge1xuICAgIGlkOiAnYXNzZXRJZCcsXG4gICAgcGFja2FnaW5nOiAnY29udGFpbmVyLWltYWdlJyxcbiAgICBwYXRoOiAnL2ZvbycsXG4gICAgcmVwb3NpdG9yeU5hbWU6ICdzb21lLW5hbWUnLFxuICAgIGltYWdlVGFnOiAnaW1hZ2UtdGFnJyxcbiAgICBzb3VyY2VIYXNoOiAnMDEyMzQ1Njc4OWFiY2RlZicsXG4gIH07XG5cbiAgdHJ5IHtcbiAgICBhd2FpdCBwcmVwYXJlQ29udGFpbmVyQXNzZXQoJy4nLCBhc3NldCwgdG9vbGtpdCwgZmFsc2UpO1xuICB9IGNhdGNoIChlKSB7XG4gICAgaWYgKCEvU1RPUFRFU1QvLnRlc3QoZS50b1N0cmluZygpKSkgeyB0aHJvdyBlOyB9XG4gIH1cblxuICAvLyBUSEVOXG4gIGV4cGVjdChjcmVhdGVkTmFtZSkudG9CZSgnc29tZS1uYW1lJyk7XG59KTtcblxudGVzdCgnY29uZmlndXJlcyBpbWFnZSBzY2FubmluZycsIGFzeW5jICgpID0+IHtcbiAgLy8gR0lWRU5cbiAgbGV0IHB1dEltYWdlU2Nhbm5pbmdDb25maWd1cmF0aW9uUGFyYW1zO1xuXG4gIGNvbnN0IHNkayA9IG5ldyBNb2NrU0RLKCk7XG4gIHNkay5zdHViRWNyKHtcbiAgICBkZXNjcmliZVJlcG9zaXRvcmllczogKCkgPT4gKHsgcmVwb3NpdG9yaWVzOiBbXSB9KSxcbiAgICBjcmVhdGVSZXBvc2l0b3J5OiAoKSA9PiAoeyByZXBvc2l0b3J5OiB7IHJlcG9zaXRvcnlVcmk6ICd1cmknIH0gfSksXG4gICAgcHV0SW1hZ2VTY2FubmluZ0NvbmZpZ3VyYXRpb246IHBhcmFtcyA9PiB7XG4gICAgICBwdXRJbWFnZVNjYW5uaW5nQ29uZmlndXJhdGlvblBhcmFtcyA9IHBhcmFtcztcblxuICAgICAgLy8gU3RvcCB0aGUgdGVzdCBzbyB0aGF0IHdlIGRvbid0IGFjdHVhbGx5IGRvY2tlciBidWlsZFxuICAgICAgdGhyb3cgbmV3IEVycm9yKCdTVE9QVEVTVCcpO1xuICAgIH1cbiAgfSk7XG5cbiAgY29uc3QgdG9vbGtpdCA9IG5ld01vY2tUb29sa2l0SW5mbyhzZGspO1xuXG4gIC8vIFdIRU5cbiAgY29uc3QgYXNzZXQ6IGN4YXBpLkNvbnRhaW5lckltYWdlQXNzZXRNZXRhZGF0YUVudHJ5ID0ge1xuICAgIGlkOiAnYXNzZXRJZCcsXG4gICAgcGFja2FnaW5nOiAnY29udGFpbmVyLWltYWdlJyxcbiAgICBwYXRoOiAnL2ZvbycsXG4gICAgcmVwb3NpdG9yeU5hbWU6ICdzb21lLW5hbWUnLFxuICAgIGltYWdlVGFnOiAnc29tZS10YWcnLFxuICAgIHNvdXJjZUhhc2g6ICcwMTIzNDU2Nzg5YWJjZGVmJyxcbiAgfTtcblxuICB0cnkge1xuICAgIGF3YWl0IHByZXBhcmVDb250YWluZXJBc3NldCgnLicsIGFzc2V0LCB0b29sa2l0LCBmYWxzZSk7XG4gIH0gY2F0Y2ggKGUpIHtcbiAgICBpZiAoIS9TVE9QVEVTVC8udGVzdChlLnRvU3RyaW5nKCkpKSB7IHRocm93IGU7IH1cbiAgfVxuXG4gIGV4cGVjdChwdXRJbWFnZVNjYW5uaW5nQ29uZmlndXJhdGlvblBhcmFtcykudG9FcXVhbCh7XG4gICAgcmVwb3NpdG9yeU5hbWU6ICdzb21lLW5hbWUnLFxuICAgIGltYWdlU2Nhbm5pbmdDb25maWd1cmF0aW9uOiB7XG4gICAgICBzY2FuT25QdXNoOiB0cnVlXG4gICAgfVxuICB9KTtcbn0pO1xuXG50ZXN0KCdjYWxscyBkb2NrZXIgbG9naW4gd2l0aCB0aGUgY29ycmVjdHMgYXJncyBhbmQgYmVmb3JlIGRvY2tlciBidWlsZCcsIGFzeW5jICgpID0+IHtcbiAgLy8gR0lWRU5cbiAgY29uc3QgdG9vbGtpdCA9IG5ld01vY2tUb29sa2l0SW5mbygpO1xuXG4gIGNvbnN0IHByZXBhcmVFY3JSZXBvc2l0b3J5U3R1YiA9IHNpbm9uLnN0dWIodG9vbGtpdCwgJ3ByZXBhcmVFY3JSZXBvc2l0b3J5JykucmVzb2x2ZXMoeyByZXBvc2l0b3J5VXJpOiAndXJpJyB9KTtcbiAgY29uc3QgY2hlY2tFY3JJbWFnZVN0dWIgPSBzaW5vbi5zdHViKHRvb2xraXQsICdjaGVja0VjckltYWdlJykucmVzb2x2ZXMoZmFsc2UpO1xuICBjb25zdCBzaGVsbFN0dWIgPSBzaW5vbi5zdHViKG9zLCAnc2hlbGwnKS5jYWxsc0Zha2Uoc2hlbGxGYWtlKTtcbiAgY29uc3QgZ2V0RWNyQ3JlZGVudGlhbHNTdHViID0gc2lub24uc3R1Yih0b29sa2l0LCAnZ2V0RWNyQ3JlZGVudGlhbHMnKS5yZXNvbHZlcyh7XG4gICAgdXNlcm5hbWU6ICd1c2VybmFtZScsXG4gICAgcGFzc3dvcmQ6ICdwYXNzd29yZCcsXG4gICAgZW5kcG9pbnQ6ICdlbmRwb2ludCdcbiAgfSk7XG5cbiAgLy8gV0hFTlxuICBjb25zdCBhc3NldDogY3hhcGkuQ29udGFpbmVySW1hZ2VBc3NldE1ldGFkYXRhRW50cnkgPSB7XG4gICAgaWQ6ICdhc3NldElkJyxcbiAgICBwYWNrYWdpbmc6ICdjb250YWluZXItaW1hZ2UnLFxuICAgIHBhdGg6ICcvZm9vJyxcbiAgICBzb3VyY2VIYXNoOiAnMTIzNDU2Nzg5MGFiY2RlZicsXG4gICAgcmVwb3NpdG9yeU5hbWU6ICdzb21lLW5hbWUnLFxuICAgIGltYWdlVGFnOiAnc29tZS10YWcnLFxuICAgIGJ1aWxkQXJnczoge1xuICAgICAgYTogJ2InLFxuICAgICAgYzogJ2QnXG4gICAgfSxcbiAgICB0YXJnZXQ6ICdhLXRhcmdldCcsXG4gIH07XG5cbiAgdHJ5IHtcbiAgICBhd2FpdCBwcmVwYXJlQ29udGFpbmVyQXNzZXQoJy4nLCBhc3NldCwgdG9vbGtpdCwgZmFsc2UpO1xuICB9IGNhdGNoIChlKSB7XG4gICAgaWYgKCEvU1RPUFRFU1QvLnRlc3QoZS50b1N0cmluZygpKSkgeyB0aHJvdyBlOyB9XG4gIH1cblxuICAvLyBUSEVOXG4gIGNvbnN0IGNvbW1hbmQgPSBbJ2RvY2tlcicsICdsb2dpbicsICctLXVzZXJuYW1lJywgJ3VzZXJuYW1lJywgJy0tcGFzc3dvcmQnLCAncGFzc3dvcmQnLCAnZW5kcG9pbnQnXTtcbiAgc2lub24uYXNzZXJ0LmNhbGxlZFdpdGgoc2hlbGxTdHViLmZpcnN0Q2FsbCwgY29tbWFuZCk7XG5cbiAgcHJlcGFyZUVjclJlcG9zaXRvcnlTdHViLnJlc3RvcmUoKTtcbiAgc2hlbGxTdHViLnJlc3RvcmUoKTtcbiAgY2hlY2tFY3JJbWFnZVN0dWIucmVzdG9yZSgpO1xuICBnZXRFY3JDcmVkZW50aWFsc1N0dWIucmVzdG9yZSgpO1xufSk7XG5cbnRlc3QoJ3Bhc3NlcyB0aGUgY29ycmVjdCB0YXJnZXQgdG8gZG9ja2VyIGJ1aWxkJywgYXN5bmMgKCkgPT4ge1xuICAvLyBHSVZFTlxuICBjb25zdCB0b29sa2l0ID0gbmV3TW9ja1Rvb2xraXRJbmZvKCk7XG5cbiAgY29uc3QgcHJlcGFyZUVjclJlcG9zaXRvcnlTdHViID0gc2lub24uc3R1Yih0b29sa2l0LCAncHJlcGFyZUVjclJlcG9zaXRvcnknKS5yZXNvbHZlcyh7IHJlcG9zaXRvcnlVcmk6ICd1cmknIH0pO1xuICBjb25zdCBjaGVja0VjckltYWdlU3R1YiA9IHNpbm9uLnN0dWIodG9vbGtpdCwgJ2NoZWNrRWNySW1hZ2UnKS5yZXNvbHZlcyhmYWxzZSk7XG4gIGNvbnN0IHNoZWxsU3R1YiA9IHNpbm9uLnN0dWIob3MsICdzaGVsbCcpLmNhbGxzRmFrZShzaGVsbEZha2UpO1xuICBjb25zdCBnZXRFY3JDcmVkZW50aWFsc1N0dWIgPSBzaW5vbi5zdHViKHRvb2xraXQsICdnZXRFY3JDcmVkZW50aWFscycpLnJlc29sdmVzKHtcbiAgICB1c2VybmFtZTogJ3VzZXJuYW1lJyxcbiAgICBwYXNzd29yZDogJ3Bhc3N3b3JkJyxcbiAgICBlbmRwb2ludDogJ2VuZHBvaW50J1xuICB9KTtcblxuICAvLyBXSEVOXG4gIGNvbnN0IGFzc2V0OiBjeGFwaS5Db250YWluZXJJbWFnZUFzc2V0TWV0YWRhdGFFbnRyeSA9IHtcbiAgICBpZDogJ2Fzc2V0SWQnLFxuICAgIHBhY2thZ2luZzogJ2NvbnRhaW5lci1pbWFnZScsXG4gICAgcGF0aDogJy9mb28nLFxuICAgIHNvdXJjZUhhc2g6ICcxMjM0NTY3ODkwYWJjZGVmJyxcbiAgICByZXBvc2l0b3J5TmFtZTogJ3NvbWUtbmFtZScsXG4gICAgaW1hZ2VUYWc6ICdzb21lLXRhZycsXG4gICAgYnVpbGRBcmdzOiB7XG4gICAgICBhOiAnYicsXG4gICAgICBjOiAnZCdcbiAgICB9LFxuICAgIHRhcmdldDogJ2EtdGFyZ2V0JyxcbiAgfTtcblxuICB0cnkge1xuICAgIGF3YWl0IHByZXBhcmVDb250YWluZXJBc3NldCgnLicsIGFzc2V0LCB0b29sa2l0LCBmYWxzZSk7XG4gIH0gY2F0Y2ggKGUpIHtcbiAgICBpZiAoIS9TVE9QVEVTVC8udGVzdChlLnRvU3RyaW5nKCkpKSB7IHRocm93IGU7IH1cbiAgfVxuXG4gIC8vIFRIRU5cbiAgY29uc3QgY29tbWFuZCA9IFsgJ2RvY2tlcicsICdidWlsZCcsICctLXRhZycsIGB1cmk6c29tZS10YWdgLCAnLS10YXJnZXQnLCAnYS10YXJnZXQnLCAnLS1idWlsZC1hcmcnLCAnYT1iJywgJy0tYnVpbGQtYXJnJywgJ2M9ZCcsICcvZm9vJyBdO1xuICBzaW5vbi5hc3NlcnQuY2FsbGVkV2l0aChzaGVsbFN0dWIsIGNvbW1hbmQpO1xuXG4gIHByZXBhcmVFY3JSZXBvc2l0b3J5U3R1Yi5yZXN0b3JlKCk7XG4gIHNoZWxsU3R1Yi5yZXN0b3JlKCk7XG4gIGNoZWNrRWNySW1hZ2VTdHViLnJlc3RvcmUoKTtcbiAgZ2V0RWNyQ3JlZGVudGlhbHNTdHViLnJlc3RvcmUoKTtcbn0pO1xuXG50ZXN0KCdwYXNzZXMgdGhlIGNvcnJlY3QgYXJncyB0byBkb2NrZXIgYnVpbGQnLCBhc3luYyAoKSA9PiB7XG4gIC8vIEdJVkVOXG4gIGNvbnN0IHRvb2xraXQgPSBuZXdNb2NrVG9vbGtpdEluZm8oKTtcblxuICBjb25zdCBwcmVwYXJlRWNyUmVwb3NpdG9yeVN0dWIgPSBzaW5vbi5zdHViKHRvb2xraXQsICdwcmVwYXJlRWNyUmVwb3NpdG9yeScpLnJlc29sdmVzKHsgcmVwb3NpdG9yeVVyaTogJ3VyaScgfSk7XG4gIGNvbnN0IGNoZWNrRWNySW1hZ2VTdHViID0gc2lub24uc3R1Yih0b29sa2l0LCAnY2hlY2tFY3JJbWFnZScpLnJlc29sdmVzKGZhbHNlKTtcbiAgY29uc3Qgc2hlbGxTdHViID0gc2lub24uc3R1YihvcywgJ3NoZWxsJykuY2FsbHNGYWtlKHNoZWxsRmFrZSk7XG4gIGNvbnN0IGdldEVjckNyZWRlbnRpYWxzU3R1YiA9IHNpbm9uLnN0dWIodG9vbGtpdCwgJ2dldEVjckNyZWRlbnRpYWxzJykucmVzb2x2ZXMoe1xuICAgIHVzZXJuYW1lOiAndXNlcm5hbWUnLFxuICAgIHBhc3N3b3JkOiAncGFzc3dvcmQnLFxuICAgIGVuZHBvaW50OiAnZW5kcG9pbnQnXG4gIH0pO1xuXG4gIC8vIFdIRU5cbiAgY29uc3QgYXNzZXQ6IGN4YXBpLkNvbnRhaW5lckltYWdlQXNzZXRNZXRhZGF0YUVudHJ5ID0ge1xuICAgIGlkOiAnYXNzZXRJZCcsXG4gICAgcGFja2FnaW5nOiAnY29udGFpbmVyLWltYWdlJyxcbiAgICBwYXRoOiAnL2ZvbycsXG4gICAgc291cmNlSGFzaDogJzEyMzQ1Njc4OTBhYmNkZWYnLFxuICAgIHJlcG9zaXRvcnlOYW1lOiAnc29tZS1uYW1lJyxcbiAgICBpbWFnZVRhZzogJ3NvbWUtdGFnJyxcbiAgICBidWlsZEFyZ3M6IHtcbiAgICAgIGE6ICdiJyxcbiAgICAgIGM6ICdkJ1xuICAgIH1cbiAgfTtcblxuICB0cnkge1xuICAgIGF3YWl0IHByZXBhcmVDb250YWluZXJBc3NldCgnLicsIGFzc2V0LCB0b29sa2l0LCBmYWxzZSk7XG4gIH0gY2F0Y2ggKGUpIHtcbiAgICBpZiAoIS9TVE9QVEVTVC8udGVzdChlLnRvU3RyaW5nKCkpKSB7IHRocm93IGU7IH1cbiAgfVxuXG4gIC8vIFRIRU5cbiAgY29uc3QgY29tbWFuZCA9IFsnZG9ja2VyJywgJ2J1aWxkJywgJy0tdGFnJywgYHVyaTpzb21lLXRhZ2AsICctLWJ1aWxkLWFyZycsICdhPWInLCAnLS1idWlsZC1hcmcnLCAnYz1kJywgJy9mb28nXTtcbiAgc2lub24uYXNzZXJ0LmNhbGxlZFdpdGgoc2hlbGxTdHViLCBjb21tYW5kKTtcblxuICBwcmVwYXJlRWNyUmVwb3NpdG9yeVN0dWIucmVzdG9yZSgpO1xuICBjaGVja0VjckltYWdlU3R1Yi5yZXN0b3JlKCk7XG4gIHNoZWxsU3R1Yi5yZXN0b3JlKCk7XG4gIGdldEVjckNyZWRlbnRpYWxzU3R1Yi5yZXN0b3JlKCk7XG59KTtcblxudGVzdCgncGFzc2VzIHRoZSBjb3JyZWN0IGRvY2tlciBmaWxlIG5hbWUgaWYgc3BlY2lmaWVkJywgYXN5bmMgKCkgPT4ge1xuICBjb25zdCB0b29sa2l0ID0gbmV3TW9ja1Rvb2xraXRJbmZvKCk7XG4gIGNvbnN0IHByZXBhcmVFY3JSZXBvc2l0b3J5U3R1YiA9IHNpbm9uLnN0dWIodG9vbGtpdCwgJ3ByZXBhcmVFY3JSZXBvc2l0b3J5JykucmVzb2x2ZXMoeyByZXBvc2l0b3J5VXJpOiAndXJpJyB9KTtcbiAgY29uc3QgY2hlY2tFY3JJbWFnZVN0dWIgPSBzaW5vbi5zdHViKHRvb2xraXQsICdjaGVja0VjckltYWdlJykucmVzb2x2ZXMoZmFsc2UpO1xuICBjb25zdCBzaGVsbFN0dWIgPSBzaW5vbi5zdHViKG9zLCAnc2hlbGwnKS5jYWxsc0Zha2Uoc2hlbGxGYWtlKTtcbiAgY29uc3QgZ2V0RWNyQ3JlZGVudGlhbHNTdHViID0gc2lub24uc3R1Yih0b29sa2l0LCAnZ2V0RWNyQ3JlZGVudGlhbHMnKS5yZXNvbHZlcyh7XG4gICAgdXNlcm5hbWU6ICd1c2VybmFtZScsXG4gICAgcGFzc3dvcmQ6ICdwYXNzd29yZCcsXG4gICAgZW5kcG9pbnQ6ICdlbmRwb2ludCdcbiAgfSk7XG5cbiAgLy8gV0hFTlxuICBjb25zdCBhc3NldDogY3hhcGkuQ29udGFpbmVySW1hZ2VBc3NldE1ldGFkYXRhRW50cnkgPSB7XG4gICAgaWQ6ICdhc3NldElkJyxcbiAgICBwYWNrYWdpbmc6ICdjb250YWluZXItaW1hZ2UnLFxuICAgIHBhdGg6ICcvZm9vJyxcbiAgICBzb3VyY2VIYXNoOiAnMTIzNDU2Nzg5MGFiY2RlZicsXG4gICAgcmVwb3NpdG9yeU5hbWU6ICdzb21lLW5hbWUnLFxuICAgIGltYWdlVGFnOiAnc29tZS10YWcnLFxuICAgIGZpbGU6ICdDdXN0b21Eb2NrZXJmaWxlJyxcbiAgICBidWlsZEFyZ3M6IHtcbiAgICAgIGE6ICdiJyxcbiAgICAgIGM6ICdkJ1xuICAgIH1cbiAgfTtcblxuICB0cnkge1xuICAgIGF3YWl0IHByZXBhcmVDb250YWluZXJBc3NldCgnLicsIGFzc2V0LCB0b29sa2l0LCBmYWxzZSk7XG4gIH0gY2F0Y2ggKGUpIHtcbiAgICBpZiAoIS9TVE9QVEVTVC8udGVzdChlLnRvU3RyaW5nKCkpKSB7IHRocm93IGU7IH1cbiAgfVxuXG4gIC8vIFRIRU5cbiAgY29uc3QgY29tbWFuZCA9IFsnZG9ja2VyJywgJ2J1aWxkJywgJy0tdGFnJywgYHVyaTpzb21lLXRhZ2AsICctLWZpbGUnLCAnL2Zvby9DdXN0b21Eb2NrZXJmaWxlJywgJy0tYnVpbGQtYXJnJywgJ2E9YicsICctLWJ1aWxkLWFyZycsICdjPWQnLCAnL2ZvbyddO1xuICBzaW5vbi5hc3NlcnQuY2FsbGVkV2l0aChzaGVsbFN0dWIsIGNvbW1hbmQpO1xuXG4gIHByZXBhcmVFY3JSZXBvc2l0b3J5U3R1Yi5yZXN0b3JlKCk7XG4gIGNoZWNrRWNySW1hZ2VTdHViLnJlc3RvcmUoKTtcbiAgc2hlbGxTdHViLnJlc3RvcmUoKTtcbiAgZ2V0RWNyQ3JlZGVudGlhbHNTdHViLnJlc3RvcmUoKTtcbn0pO1xuXG50ZXN0KCdyZWxhdGl2ZSBwYXRoJywgYXN5bmMgKCkgPT4ge1xuICAvLyBHSVZFTlxuICBjb25zdCB0b29sa2l0ID0gbmV3TW9ja1Rvb2xraXRJbmZvKCk7XG4gIGNvbnN0IHByZXBhcmVFY3JSZXBvc2l0b3J5U3R1YiA9IHNpbm9uLnN0dWIodG9vbGtpdCwgJ3ByZXBhcmVFY3JSZXBvc2l0b3J5JykucmVzb2x2ZXMoeyByZXBvc2l0b3J5VXJpOiAndXJpJyB9KTtcbiAgY29uc3QgY2hlY2tFY3JJbWFnZVN0dWIgPSBzaW5vbi5zdHViKHRvb2xraXQsICdjaGVja0VjckltYWdlJykucmVzb2x2ZXMoZmFsc2UpO1xuICBjb25zdCBzaGVsbFN0dWIgPSBzaW5vbi5zdHViKG9zLCAnc2hlbGwnKS5jYWxsc0Zha2Uoc2hlbGxGYWtlKTtcbiAgY29uc3QgZ2V0RWNyQ3JlZGVudGlhbHNTdHViID0gc2lub24uc3R1Yih0b29sa2l0LCAnZ2V0RWNyQ3JlZGVudGlhbHMnKS5yZXNvbHZlcyh7XG4gICAgdXNlcm5hbWU6ICd1c2VybmFtZScsXG4gICAgcGFzc3dvcmQ6ICdwYXNzd29yZCcsXG4gICAgZW5kcG9pbnQ6ICdlbmRwb2ludCdcbiAgfSk7XG5cbiAgLy8gV0hFTlxuICBjb25zdCBhc3NldDogY3hhcGkuQ29udGFpbmVySW1hZ2VBc3NldE1ldGFkYXRhRW50cnkgPSB7XG4gICAgaWQ6ICdhc3NldElkJyxcbiAgICBwYWNrYWdpbmc6ICdjb250YWluZXItaW1hZ2UnLFxuICAgIHBhdGg6ICdyZWxhdGl2ZS10by1hc3NlbWJseScsXG4gICAgc291cmNlSGFzaDogJzEyMzQ1Njc4OTBhYmNkZWYnLFxuICAgIHJlcG9zaXRvcnlOYW1lOiAnc29tZS1uYW1lJyxcbiAgICBpbWFnZVRhZzogJ3NvbWUtdGFnJyxcbiAgICBidWlsZEFyZ3M6IHtcbiAgICAgIGE6ICdiJyxcbiAgICAgIGM6ICdkJ1xuICAgIH1cbiAgfTtcblxuICB0cnkge1xuICAgIGF3YWl0IHByZXBhcmVDb250YWluZXJBc3NldCgnL2Fzc2VtYmx5L2Rpci9yb290JywgYXNzZXQsIHRvb2xraXQsIGZhbHNlKTtcbiAgfSBjYXRjaCAoZSkge1xuICAgIGlmICghL1NUT1BURVNULy50ZXN0KGUudG9TdHJpbmcoKSkpIHsgdGhyb3cgZTsgfVxuICB9XG5cbiAgLy8gVEhFTlxuICBjb25zdCBjb21tYW5kID0gWydkb2NrZXInLCAnYnVpbGQnLCAnLS10YWcnLCBgdXJpOnNvbWUtdGFnYCwgJy0tYnVpbGQtYXJnJywgJ2E9YicsICctLWJ1aWxkLWFyZycsICdjPWQnLCAnL2Fzc2VtYmx5L2Rpci9yb290L3JlbGF0aXZlLXRvLWFzc2VtYmx5J107XG4gIHNpbm9uLmFzc2VydC5jYWxsZWRXaXRoKHNoZWxsU3R1YiwgY29tbWFuZCk7XG5cbiAgcHJlcGFyZUVjclJlcG9zaXRvcnlTdHViLnJlc3RvcmUoKTtcbiAgY2hlY2tFY3JJbWFnZVN0dWIucmVzdG9yZSgpO1xuICBzaGVsbFN0dWIucmVzdG9yZSgpO1xuICBnZXRFY3JDcmVkZW50aWFsc1N0dWIucmVzdG9yZSgpO1xufSk7XG5cbnRlc3QoJ3NraXBzIGJ1aWxkICYgcHVzaCBpZiBpbWFnZSBhbHJlYWR5IGV4aXN0cyBpbiB0aGUgRUNSIHJlcG8nLCBhc3luYyAoKSA9PiB7XG4gIC8vIEdJVkVOXG4gIGNvbnN0IHRvb2xraXQgPSBuZXdNb2NrVG9vbGtpdEluZm8oKTtcbiAgY29uc3QgcHJlcGFyZUVjclJlcG9zaXRvcnlTdHViID0gc2lub24uc3R1Yih0b29sa2l0LCAncHJlcGFyZUVjclJlcG9zaXRvcnknKTtcbiAgY29uc3Qgc2hlbGxTdHViID0gc2lub24uc3R1YihvcywgJ3NoZWxsJyk7XG4gIGNvbnN0IGNoZWNrRWNySW1hZ2VTdHViID0gc2lub24uc3R1Yih0b29sa2l0LCAnY2hlY2tFY3JJbWFnZScpLnJlc29sdmVzKHRydWUpO1xuXG4gIC8vIFdIRU5cbiAgY29uc3QgYXNzZXQ6IGN4YXBpLkNvbnRhaW5lckltYWdlQXNzZXRNZXRhZGF0YUVudHJ5ID0ge1xuICAgIGlkOiAnYXNzZXRJZCcsXG4gICAgcGFja2FnaW5nOiAnY29udGFpbmVyLWltYWdlJyxcbiAgICBwYXRoOiAncmVsYXRpdmUtdG8tYXNzZW1ibHknLFxuICAgIHNvdXJjZUhhc2g6ICcxMjM0NTY3ODkwYWJjZGVmJyxcbiAgICByZXBvc2l0b3J5TmFtZTogJ3NvbWUtbmFtZScsXG4gICAgaW1hZ2VUYWc6ICdzb21lLXRhZycsXG4gICAgYnVpbGRBcmdzOiB7XG4gICAgICBhOiAnYicsXG4gICAgICBjOiAnZCdcbiAgICB9XG4gIH07XG5cbiAgYXdhaXQgcHJlcGFyZUNvbnRhaW5lckFzc2V0KCcvYXNzZW1ibHkvZGlyL3Jvb3QnLCBhc3NldCwgdG9vbGtpdCwgZmFsc2UpO1xuXG4gIC8vIFRIRU5cbiAgc2lub24uYXNzZXJ0LmNhbGxlZE9uY2UocHJlcGFyZUVjclJlcG9zaXRvcnlTdHViKTtcbiAgc2lub24uYXNzZXJ0LmNhbGxlZE9uY2UoY2hlY2tFY3JJbWFnZVN0dWIpO1xuICBzaW5vbi5hc3NlcnQubm90Q2FsbGVkKHNoZWxsU3R1Yik7XG59KTtcblxuZnVuY3Rpb24gbmV3TW9ja1Rvb2xraXRJbmZvKHNkazogTW9ja1NESyA9IG5ldyBNb2NrU0RLKCkpIHtcbiAgcmV0dXJuIG5ldyBUb29sa2l0SW5mbyh7XG4gICAgc2RrLFxuICAgIGJ1Y2tldE5hbWU6ICdCVUNLRVRfTkFNRScsXG4gICAgYnVja2V0RW5kcG9pbnQ6ICdCVUNLRVRfRU5EUE9JTlQnLFxuICAgIGVudmlyb25tZW50OiB7IG5hbWU6ICdlbnYnLCBhY2NvdW50OiAnMTIzNCcsIHJlZ2lvbjogJ2FiYycgfVxuICB9KTtcbn0iXX0=