"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const lib_1 = require("../../lib");
const util_1 = require("../util");
const mock_sdk_1 = require("../util/mock-sdk");
const FAKE_TEMPLATE = { resource: 'noerrorresource' };
const FAKE_STACK = util_1.testStack({
    stackName: 'withouterrors',
    template: FAKE_TEMPLATE,
});
test('do deploy executable change set with 0 changes', async () => {
    // GIVEN
    const sdk = new mock_sdk_1.MockSDK();
    let executed = false;
    sdk.stubCloudFormation({
        describeStacks() {
            return {
                Stacks: []
            };
        },
        createChangeSet() {
            return {};
        },
        describeChangeSet() {
            return {
                Status: 'CREATE_COMPLETE',
                Changes: [],
            };
        },
        executeChangeSet() {
            executed = true;
            return {};
        }
    });
    // WHEN
    const ret = await lib_1.deployStack({
        stack: FAKE_STACK,
        sdk,
    });
    // THEN
    expect(ret.noOp).toBeFalsy();
    expect(executed).toBeTruthy();
});
test('correctly passes CFN parameters, ignoring ones with empty values', async () => {
    // GIVEN
    const sdk = new mock_sdk_1.MockSDK();
    let parameters;
    sdk.stubCloudFormation({
        describeStacks() {
            return {
                Stacks: []
            };
        },
        createChangeSet(options) {
            parameters = options.Parameters;
            return {};
        },
        describeChangeSet() {
            return {
                Status: 'CREATE_COMPLETE',
                Changes: [],
            };
        },
        executeChangeSet() {
            return {};
        }
    });
    // WHEN
    await lib_1.deployStack({
        stack: FAKE_STACK,
        sdk,
        parameters: {
            A: 'A-value',
            B: undefined,
            C: '',
        },
    });
    // THEN
    expect(parameters).toStrictEqual([
        { ParameterKey: 'A', ParameterValue: 'A-value' },
    ]);
});
test('deploy is skipped if template did not change', async () => {
    const sdk = new mock_sdk_1.MockSDK();
    let describeStacksInput;
    let getTemplateInput;
    let createChangeSetCalled = false;
    let executeChangeSetCalled = false;
    sdk.stubCloudFormation({
        getTemplate(input) {
            getTemplateInput = input;
            return {
                TemplateBody: JSON.stringify(FAKE_TEMPLATE)
            };
        },
        describeStacks(input) {
            describeStacksInput = input;
            return {
                Stacks: [
                    {
                        StackName: 'mock-stack-name',
                        StackId: 'mock-stack-id',
                        CreationTime: new Date(),
                        StackStatus: 'CREATE_COMPLETE'
                    }
                ]
            };
        },
        createChangeSet() {
            createChangeSetCalled = true;
            return {};
        },
        executeChangeSet() {
            executeChangeSetCalled = true;
            return {};
        }
    });
    await lib_1.deployStack({
        stack: FAKE_STACK,
        sdk
    });
    expect(createChangeSetCalled).toBeFalsy();
    expect(executeChangeSetCalled).toBeFalsy();
    expect(describeStacksInput).toStrictEqual({ StackName: 'withouterrors' });
    expect(getTemplateInput).toStrictEqual({ StackName: 'withouterrors', TemplateStage: 'Original' });
});
test('deploy is skipped if template and tags did not change', async () => {
    const sdk = new mock_sdk_1.MockSDK();
    let describeStacksInput;
    let getTemplateInput;
    let createChangeSetCalled = false;
    let executeChangeSetCalled = false;
    sdk.stubCloudFormation({
        getTemplate(input) {
            getTemplateInput = input;
            return {
                TemplateBody: JSON.stringify(FAKE_TEMPLATE)
            };
        },
        describeStacks(input) {
            describeStacksInput = input;
            return {
                Stacks: [
                    {
                        StackName: 'mock-stack-name',
                        StackId: 'mock-stack-id',
                        CreationTime: new Date(),
                        StackStatus: 'CREATE_COMPLETE',
                        Tags: [
                            {
                                Key: 'Key1',
                                Value: 'Value1'
                            },
                            {
                                Key: 'Key2',
                                Value: 'Value2'
                            }
                        ]
                    }
                ]
            };
        },
        createChangeSet() {
            createChangeSetCalled = true;
            return {};
        },
        executeChangeSet() {
            executeChangeSetCalled = true;
            return {};
        }
    });
    await lib_1.deployStack({
        stack: FAKE_STACK,
        tags: [
            {
                Key: 'Key1',
                Value: 'Value1'
            },
            {
                Key: 'Key2',
                Value: 'Value2'
            }
        ],
        sdk
    });
    expect(createChangeSetCalled).toBeFalsy();
    expect(executeChangeSetCalled).toBeFalsy();
    expect(describeStacksInput).toStrictEqual({ StackName: 'withouterrors' });
    expect(getTemplateInput).toStrictEqual({ StackName: 'withouterrors', TemplateStage: 'Original' });
});
test('deploy not skipped if template did not change but tags changed', async () => {
    const sdk = new mock_sdk_1.MockSDK();
    let describeStacksInput;
    let getTemplateInput;
    let createChangeSetCalled = false;
    let executeChangeSetCalled = false;
    let describeChangeSetCalled = false;
    sdk.stubCloudFormation({
        getTemplate(input) {
            getTemplateInput = input;
            return {
                TemplateBody: JSON.stringify(FAKE_TEMPLATE)
            };
        },
        describeStacks(input) {
            describeStacksInput = input;
            return {
                Stacks: [
                    {
                        StackName: 'mock-stack-name',
                        StackId: 'mock-stack-id',
                        CreationTime: new Date(),
                        StackStatus: 'CREATE_COMPLETE',
                        Tags: [
                            {
                                Key: 'Key',
                                Value: 'Value'
                            },
                        ]
                    }
                ]
            };
        },
        createChangeSet() {
            createChangeSetCalled = true;
            return {};
        },
        executeChangeSet() {
            executeChangeSetCalled = true;
            return {};
        },
        describeChangeSet() {
            describeChangeSetCalled = true;
            return {
                Status: 'CREATE_COMPLETE',
                Changes: [],
            };
        }
    });
    await lib_1.deployStack({
        stack: FAKE_STACK,
        sdk,
        tags: [
            {
                Key: 'Key',
                Value: 'NewValue'
            }
        ]
    });
    expect(createChangeSetCalled).toBeTruthy();
    expect(executeChangeSetCalled).toBeTruthy();
    expect(describeChangeSetCalled).toBeTruthy();
    expect(describeStacksInput).toStrictEqual({ StackName: "withouterrors" });
    expect(getTemplateInput).toStrictEqual({ StackName: 'withouterrors', TemplateStage: 'Original' });
});
test('deploy not skipped if template did not change but one tag removed', async () => {
    const sdk = new mock_sdk_1.MockSDK();
    let describeStacksInput;
    let getTemplateInput;
    let createChangeSetCalled = false;
    let executeChangeSetCalled = false;
    let describeChangeSetCalled = false;
    sdk.stubCloudFormation({
        getTemplate(input) {
            getTemplateInput = input;
            return {
                TemplateBody: JSON.stringify(FAKE_TEMPLATE)
            };
        },
        describeStacks(input) {
            describeStacksInput = input;
            return {
                Stacks: [
                    {
                        StackName: 'mock-stack-name',
                        StackId: 'mock-stack-id',
                        CreationTime: new Date(),
                        StackStatus: 'CREATE_COMPLETE',
                        Tags: [
                            {
                                Key: 'Key1',
                                Value: 'Value1'
                            },
                            {
                                Key: 'Key2',
                                Value: 'Value2'
                            },
                        ]
                    }
                ]
            };
        },
        createChangeSet() {
            createChangeSetCalled = true;
            return {};
        },
        executeChangeSet() {
            executeChangeSetCalled = true;
            return {};
        },
        describeChangeSet() {
            describeChangeSetCalled = true;
            return {
                Status: 'CREATE_COMPLETE',
                Changes: [],
            };
        }
    });
    await lib_1.deployStack({
        stack: FAKE_STACK,
        sdk,
        tags: [
            {
                Key: 'Key1',
                Value: 'Value1'
            }
        ]
    });
    expect(createChangeSetCalled).toBeTruthy();
    expect(executeChangeSetCalled).toBeTruthy();
    expect(describeChangeSetCalled).toBeTruthy();
    expect(describeStacksInput).toStrictEqual({ StackName: "withouterrors" });
    expect(getTemplateInput).toStrictEqual({ StackName: 'withouterrors', TemplateStage: 'Original' });
});
test('deploy not skipped if template did not change and --force is applied', async () => {
    const sdk = new mock_sdk_1.MockSDK();
    let describeStacksInput;
    let getTemplateInput;
    let createChangeSetCalled = false;
    let executeChangeSetCalled = false;
    let describeChangeSetCalled = false;
    sdk.stubCloudFormation({
        getTemplate(input) {
            getTemplateInput = input;
            return {
                TemplateBody: JSON.stringify(FAKE_TEMPLATE)
            };
        },
        describeStacks(input) {
            describeStacksInput = input;
            return {
                Stacks: [
                    {
                        StackName: 'mock-stack-name',
                        StackId: 'mock-stack-id',
                        CreationTime: new Date(),
                        StackStatus: 'CREATE_COMPLETE'
                    }
                ]
            };
        },
        createChangeSet() {
            createChangeSetCalled = true;
            return {};
        },
        executeChangeSet() {
            executeChangeSetCalled = true;
            return {};
        },
        describeChangeSet() {
            describeChangeSetCalled = true;
            return {
                Status: 'CREATE_COMPLETE',
                Changes: [],
            };
        }
    });
    await lib_1.deployStack({
        stack: FAKE_STACK,
        sdk,
        force: true
    });
    expect(createChangeSetCalled).toBeTruthy();
    expect(executeChangeSetCalled).toBeTruthy();
    expect(describeChangeSetCalled).toBeTruthy();
    expect(getTemplateInput).toBeUndefined();
    expect(describeStacksInput).toStrictEqual({ StackName: "withouterrors" });
});
test('deploy not skipped if template changed', async () => {
    const sdk = new mock_sdk_1.MockSDK();
    let describeStacksInput;
    let getTemplateInput;
    let createChangeSetCalled = false;
    let executeChangeSetCalled = false;
    let describeChangeSetCalled = false;
    sdk.stubCloudFormation({
        getTemplate(input) {
            getTemplateInput = input;
            return {
                TemplateBody: JSON.stringify({ changed: 123 })
            };
        },
        describeStacks(input) {
            describeStacksInput = input;
            return {
                Stacks: [
                    {
                        StackName: 'mock-stack-name',
                        StackId: 'mock-stack-id',
                        CreationTime: new Date(),
                        StackStatus: 'CREATE_COMPLETE'
                    }
                ]
            };
        },
        createChangeSet() {
            createChangeSetCalled = true;
            return {};
        },
        executeChangeSet() {
            executeChangeSetCalled = true;
            return {};
        },
        describeChangeSet() {
            describeChangeSetCalled = true;
            return {
                Status: 'CREATE_COMPLETE',
                Changes: [],
            };
        }
    });
    await lib_1.deployStack({
        stack: FAKE_STACK,
        sdk
    });
    expect(createChangeSetCalled).toBeTruthy();
    expect(executeChangeSetCalled).toBeTruthy();
    expect(describeChangeSetCalled).toBeTruthy();
    expect(describeStacksInput).toStrictEqual({ StackName: "withouterrors" });
    expect(getTemplateInput).toStrictEqual({ StackName: 'withouterrors', TemplateStage: 'Original' });
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZGVwbG95LXN0YWNrLnRlc3QuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyJkZXBsb3ktc3RhY2sudGVzdC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOztBQUFBLG1DQUF3QztBQUN4QyxrQ0FBb0M7QUFDcEMsK0NBQTJDO0FBRTNDLE1BQU0sYUFBYSxHQUFHLEVBQUUsUUFBUSxFQUFFLGlCQUFpQixFQUFFLENBQUM7QUFFdEQsTUFBTSxVQUFVLEdBQUcsZ0JBQVMsQ0FBQztJQUMzQixTQUFTLEVBQUUsZUFBZTtJQUMxQixRQUFRLEVBQUUsYUFBYTtDQUN4QixDQUFDLENBQUM7QUFFSCxJQUFJLENBQUMsZ0RBQWdELEVBQUUsS0FBSyxJQUFJLEVBQUU7SUFDaEUsUUFBUTtJQUNSLE1BQU0sR0FBRyxHQUFHLElBQUksa0JBQU8sRUFBRSxDQUFDO0lBRTFCLElBQUksUUFBUSxHQUFHLEtBQUssQ0FBQztJQUVyQixHQUFHLENBQUMsa0JBQWtCLENBQUM7UUFDckIsY0FBYztZQUNaLE9BQU87Z0JBQ0wsTUFBTSxFQUFFLEVBQUU7YUFDWCxDQUFDO1FBQ0osQ0FBQztRQUVELGVBQWU7WUFDYixPQUFPLEVBQUUsQ0FBQztRQUNaLENBQUM7UUFFRCxpQkFBaUI7WUFDZixPQUFPO2dCQUNMLE1BQU0sRUFBRSxpQkFBaUI7Z0JBQ3pCLE9BQU8sRUFBRSxFQUFFO2FBQ1osQ0FBQztRQUNKLENBQUM7UUFFRCxnQkFBZ0I7WUFDZCxRQUFRLEdBQUcsSUFBSSxDQUFDO1lBQ2hCLE9BQU8sRUFBRSxDQUFDO1FBQ1osQ0FBQztLQUNGLENBQUMsQ0FBQztJQUVILE9BQU87SUFDUCxNQUFNLEdBQUcsR0FBRyxNQUFNLGlCQUFXLENBQUM7UUFDNUIsS0FBSyxFQUFFLFVBQVU7UUFDakIsR0FBRztLQUNKLENBQUMsQ0FBQztJQUVILE9BQU87SUFDUCxNQUFNLENBQUMsR0FBRyxDQUFDLElBQUksQ0FBQyxDQUFDLFNBQVMsRUFBRSxDQUFDO0lBQzdCLE1BQU0sQ0FBQyxR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Q0QsaUJBQWlCO1lBQ2YsdUJBQXVCLEdBQUcsSUFBSSxDQUFDO1lBQy9CLE9BQU87Z0JBQ0wsTUFBTSxFQUFFLGlCQUFpQjtnQkFDekIsT0FBTyxFQUFFLEVBQUU7YUFDWixDQUFDO1FBQ0osQ0FBQztLQUNGLENBQUMsQ0FBQztJQUVILE1BQU0saUJBQVcsQ0FBQztRQUNoQixLQUFLLEVBQUUsVUFBVTtRQUNqQixHQUFHO0tBQ0osQ0FBQyxDQUFDO0lBRUgsTUFBTSxDQUFDLHFCQUFxQixDQUFDLENBQUMsVUFBVSxFQUFFLENBQUM7SUFDM0MsTUFBTSxDQUFDLHNCQUFzQixDQUFDLENBQUMsVUFBVSxFQUFFLENBQUM7SUFDNUMsTUFBTSxDQUFDLHVCQUF1QixDQUFDLENBQUMsVUFBVSxFQUFFLENBQUM7SUFDN0MsTUFBTSxDQUFDLG1CQUFvQixDQUFDLENBQUMsYUFBYSxDQUFDLEVBQUUsU0FBUyxFQUFFLGVBQWUsRUFBRSxDQUFDLENBQUM7SUFDM0UsTUFBTSxDQUFDLGdCQUFpQixDQUFDLENBQUMsYUFBYSxDQUFDLEVBQUUsU0FBUyxFQUFFLGVBQWUsRUFBRSxhQUFhLEVBQUUsVUFBVSxFQUFFLENBQUMsQ0FBQztBQUNyRyxDQUFDLENBQUMsQ0FBQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IGRlcGxveVN0YWNrIH0gZnJvbSAnLi4vLi4vbGliJztcbmltcG9ydCB7IHRlc3RTdGFjayB9IGZyb20gJy4uL3V0aWwnO1xuaW1wb3J0IHsgTW9ja1NESyB9IGZyb20gJy4uL3V0aWwvbW9jay1zZGsnO1xuXG5jb25zdCBGQUtFX1RFTVBMQVRFID0geyByZXNvdXJjZTogJ25vZXJyb3JyZXNvdXJjZScgfTtcblxuY29uc3QgRkFLRV9TVEFDSyA9IHRlc3RTdGFjayh7XG4gIHN0YWNrTmFtZTogJ3dpdGhvdXRlcnJvcnMnLFxuICB0ZW1wbGF0ZTogRkFLRV9URU1QTEFURSxcbn0pO1xuXG50ZXN0KCdkbyBkZXBsb3kgZXhlY3V0YWJsZSBjaGFuZ2Ugc2V0IHdpdGggMCBjaGFuZ2VzJywgYXN5bmMgKCkgPT4ge1xuICAvLyBHSVZFTlxuICBjb25zdCBzZGsgPSBuZXcgTW9ja1NESygpO1xuXG4gIGxldCBleGVjdXRlZCA9IGZhbHNlO1xuXG4gIHNkay5zdHViQ2xvdWRGb3JtYXRpb24oe1xuICAgIGRlc2NyaWJlU3RhY2tzKCkge1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgU3RhY2tzOiBbXVxuICAgICAgfTtcbiAgICB9LFxuXG4gICAgY3JlYXRlQ2hhbmdlU2V0KCkge1xuICAgICAgcmV0dXJuIHt9O1xuICAgIH0sXG5cbiAgICBkZXNjcmliZUNoYW5nZVNldCgpIHtcbiAgICAgIHJldHVybiB7XG4gICAgICAgIFN0YXR1czogJ0NSRUFURV9DT01QTEVURScsXG4gICAgICAgIENoYW5nZXM6IFtdLFxuICAgICAgfTtcbiAgICB9LFxuXG4gICAgZXhlY3V0ZUNoYW5nZVNldCgpIHtcbiAgICAgIGV4ZWN1dGVkID0gdHJ1ZTtcbiAgICAgIHJldHVybiB7fTtcbiAgICB9XG4gIH0pO1xuXG4gIC8vIFdIRU5cbiAgY29uc3QgcmV0ID0gYXdhaXQgZGVwbG95U3RhY2soe1xuICAgIHN0YWNrOiBGQUtFX1NUQUNLLFxuICAgIHNkayxcbiAgfSk7XG5cbiAgLy8gVEhFTlxuICBleHBlY3QocmV0Lm5vT3ApLnRvQmVGYWxzeSgpO1xuICBleHBlY3QoZXhlY3V0ZWQpLnRvQmVUcnV0aHkoKTtcbn0pO1xuXG50ZXN0KCdjb3JyZWN0bHkgcGFzc2VzIENGTiBwYXJhbWV0ZXJzLCBpZ25vcmluZyBvbmVzIHdpdGggZW1wdHkgdmFsdWVzJywgYXN5bmMgKCkgPT4ge1xuICAvLyBHSVZFTlxuICBjb25zdCBzZGsgPSBuZXcgTW9ja1NESygpO1xuXG4gIGxldCBwYXJhbWV0ZXJzOiBhbnlbXSB8IHVuZGVmaW5lZDtcblxuICBzZGsuc3R1YkNsb3VkRm9ybWF0aW9uKHtcbiAgICBkZXNjcmliZVN0YWNrcygpIHtcbiAgICAgIHJldHVybiB7XG4gICAgICAgIFN0YWNrczogW11cbiAgICAgIH07XG4gICAgfSxcblxuICAgIGNyZWF0ZUNoYW5nZVNldChvcHRpb25zKSB7XG4gICAgICBwYXJhbWV0ZXJzID0gb3B0aW9ucy5QYXJhbWV0ZXJzO1xuICAgICAgcmV0dXJuIHt9O1xuICAgIH0sXG5cbiAgICBkZXNjcmliZUNoYW5nZVNldCgpIHtcbiAgICAgIHJldHVybiB7XG4gICAgICAgIFN0YXR1czogJ0NSRUFURV9DT01QTEVURScsXG4gICAgICAgIENoYW5nZXM6IFtdLFxuICAgICAgfTtcbiAgICB9LFxuXG4gICAgZXhlY3V0ZUNoYW5nZVNldCgpIHtcbiAgICAgIHJldHVybiB7fTtcbiAgICB9XG4gIH0pO1xuXG4gIC8vIFdIRU5cbiAgYXdhaXQgZGVwbG95U3RhY2soe1xuICAgIHN0YWNrOiBGQUtFX1NUQUNLLFxuICAgIHNkayxcbiAgICBwYXJhbWV0ZXJzOiB7XG4gICAgICBBOiAnQS12YWx1ZScsXG4gICAgICBCOiB1bmRlZmluZWQsXG4gICAgICBDOiAnJyxcbiAgICB9LFxuICB9KTtcblxuICAvLyBUSEVOXG4gIGV4cGVjdChwYXJhbWV0ZXJzKS50b1N0cmljdEVxdWFsKFtcbiAgICB7IFBhcmFtZXRlcktleTogJ0EnLCBQYXJhbWV0ZXJWYWx1ZTogJ0EtdmFsdWUnIH0sXG4gIF0pO1xufSk7XG5cbnRlc3QoJ2RlcGxveSBpcyBza2lwcGVkIGlmIHRlbXBsYXRlIGRpZCBub3QgY2hhbmdlJywgYXN5bmMgKCkgPT4ge1xuICBjb25zdCBzZGsgPSBuZXcgTW9ja1NESygpO1xuICBsZXQgZGVzY3JpYmVTdGFja3NJbnB1dDogQVdTLkNsb3VkRm9ybWF0aW9uLkRlc2NyaWJlU3RhY2tzSW5wdXQ7XG4gIGxldCBnZXRUZW1wbGF0ZUlucHV0OiBBV1MuQ2xvdWRGb3JtYXRpb24uR2V0VGVtcGxhdGVJbnB1dDtcbiAgbGV0IGNyZWF0ZUNoYW5nZVNldENhbGxlZCA9IGZhbHNlO1xuICBsZXQgZXhlY3V0ZUNoYW5nZVNldENhbGxlZCA9IGZhbHNlO1xuXG4gIHNkay5zdHViQ2xvdWRGb3JtYXRpb24oe1xuICAgIGdldFRlbXBsYXRlKGlucHV0KSB7XG4gICAgICBnZXRUZW1wbGF0ZUlucHV0ID0gaW5wdXQ7XG4gICAgICByZXR1cm4ge1xuICAgICAgICBUZW1wbGF0ZUJvZHk6IEpTT04uc3RyaW5naWZ5KEZBS0VfVEVNUExBVEUpXG4gICAgICB9O1xuICAgIH0sXG4gICAgZGVzY3JpYmVTdGFja3MoaW5wdXQpIHtcbiAgICAgIGRlc2NyaWJlU3RhY2tzSW5wdXQgPSBpbnB1dDtcbiAgICAgIHJldHVybiB7XG4gICAgICAgIFN0YWNrczogW1xuICAgICAgICAgIHtcbiAgICAgICAgICAgIFN0YWNrTmFtZTogJ21vY2stc3RhY2stbmFtZScsXG4gICAgICAgICAgICBTdGFja0lkOiAnbW9jay1zdGFjay1pZCcsXG4gICAgICAgICAgICBDcmVhdGlvblRpbWU6IG5ldyBEYXRlKCksXG4gICAgICAgICAgICBTdGFja1N0YXR1czogJ0NSRUFURV9DT01QTEVURSdcbiAgICAgICAgICB9XG4gICAgICAgIF1cbiAgICAgIH07XG4gICAgfSxcbiAgICBjcmVhdGVDaGFuZ2VTZXQoKSB7XG4gICAgICBjcmVhdGVDaGFuZ2VTZXRDYWxsZWQgPSB0cnVlO1xuICAgICAgcmV0dXJuIHsgfTtcbiAgICB9LFxuICAgIGV4ZWN1dGVDaGFuZ2VTZXQoKSB7XG4gICAgICBleGVjdXRlQ2hhbmdlU2V0Q2FsbGVkID0gdHJ1ZTtcbiAgICAgIHJldHVybiB7IH07XG4gICAgfVxuICB9KTtcblxuICBhd2FpdCBkZXBsb3lTdGFjayh7XG4gICAgc3RhY2s6IEZBS0VfU1RBQ0ssXG4gICAgc2RrXG4gIH0pO1xuXG4gIGV4cGVjdChjcmVhdGVDaGFuZ2VTZXRDYWxsZWQpLnRvQmVGYWxzeSgpO1xuICBleHBlY3QoZXhlY3V0ZUNoYW5nZVNldENhbGxlZCkudG9CZUZhbHN5KCk7XG4gIGV4cGVjdChkZXNjcmliZVN0YWNrc0lucHV0ISkudG9TdHJpY3RFcXVhbCh7IFN0YWNrTmFtZTogJ3dpdGhvdXRlcnJvcnMnIH0pO1xuICBleHBlY3QoZ2V0VGVtcGxhdGVJbnB1dCEpLnRvU3RyaWN0RXF1YWwoeyBTdGFja05hbWU6ICd3aXRob3V0ZXJyb3JzJywgVGVtcGxhdGVTdGFnZTogJ09yaWdpbmFsJyB9KTtcbn0pO1xuXG50ZXN0KCdkZXBsb3kgaXMgc2tpcHBlZCBpZiB0ZW1wbGF0ZSBhbmQgdGFncyBkaWQgbm90IGNoYW5nZScsIGFzeW5jICgpID0+IHtcbiAgY29uc3Qgc2RrID0gbmV3IE1vY2tTREsoKTtcbiAgbGV0IGRlc2NyaWJlU3RhY2tzSW5wdXQ6IEFXUy5DbG91ZEZvcm1hdGlvbi5EZXNjcmliZVN0YWNrc0lucHV0O1xuICBsZXQgZ2V0VGVtcGxhdGVJbnB1dDogQVdTLkNsb3VkRm9ybWF0aW9uLkdldFRlbXBsYXRlSW5wdXQ7XG4gIGxldCBjcmVhdGVDaGFuZ2VTZXRDYWxsZWQgPSBmYWxzZTtcbiAgbGV0IGV4ZWN1dGVDaGFuZ2VTZXRDYWxsZWQgPSBmYWxzZTtcblxuICBzZGsuc3R1YkNsb3VkRm9ybWF0aW9uKHtcbiAgICBnZXRUZW1wbGF0ZShpbnB1dCkge1xuICAgICAgZ2V0VGVtcGxhdGVJbnB1dCA9IGlucHV0O1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgVGVtcGxhdGVCb2R5OiBKU09OLnN0cmluZ2lmeShGQUtFX1RFTVBMQVRFKVxuICAgICAgfTtcbiAgICB9LFxuICAgIGRlc2NyaWJlU3RhY2tzKGlucHV0KSB7XG4gICAgICBkZXNjcmliZVN0YWNrc0lucHV0ID0gaW5wdXQ7XG4gICAgICByZXR1cm4ge1xuICAgICAgICBTdGFja3M6IFtcbiAgICAgICAgICB7XG4gICAgICAgICAgICBTdGFja05hbWU6ICdtb2NrLXN0YWNrLW5hbWUnLFxuICAgICAgICAgICAgU3RhY2tJZDogJ21vY2stc3RhY2staWQnLFxuICAgICAgICAgICAgQ3JlYXRpb25UaW1lOiBuZXcgRGF0ZSgpLFxuICAgICAgICAgICAgU3RhY2tTdGF0dXM6ICdDUkVBVEVfQ09NUExFVEUnLFxuICAgICAgICAgICAgVGFnczogW1xuICAgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgS2V5OiAnS2V5MScsXG4gICAgICAgICAgICAgICAgVmFsdWU6ICdWYWx1ZTEnXG4gICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICBLZXk6ICdLZXkyJyxcbiAgICAgICAgICAgICAgICBWYWx1ZTogJ1ZhbHVlMidcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgXVxuICAgICAgICAgIH1cbiAgICAgICAgXVxuICAgICAgfTtcbiAgICB9LFxuICAgIGNyZWF0ZUNoYW5nZVNldCgpIHtcbiAgICAgIGNyZWF0ZUNoYW5nZVNldENhbGxlZCA9IHRydWU7XG4gICAgICByZXR1cm4geyB9O1xuICAgIH0sXG4gICAgZXhlY3V0ZUNoYW5nZVNldCgpIHtcbiAgICAgIGV4ZWN1dGVDaGFuZ2VTZXRDYWxsZWQgPSB0cnVlO1xuICAgICAgcmV0dXJuIHsgfTtcbiAgICB9XG4gIH0pO1xuXG4gIGF3YWl0IGRlcGxveVN0YWNrKHtcbiAgICBzdGFjazogRkFLRV9TVEFDSyxcbiAgICB0YWdzOiBbXG4gICAgICB7XG4gICAgICAgIEtleTogJ0tleTEnLFxuICAgICAgICBWYWx1ZTogJ1ZhbHVlMSdcbiAgICAgIH0sXG4gICAgICB7XG4gICAgICAgIEtleTogJ0tleTInLFxuICAgICAgICBWYWx1ZTogJ1ZhbHVlMidcbiAgICAgIH1cbiAgICBdLFxuICAgIHNka1xuICB9KTtcblxuICBleHBlY3QoY3JlYXRlQ2hhbmdlU2V0Q2FsbGVkKS50b0JlRmFsc3koKTtcbiAgZXhwZWN0KGV4ZWN1dGVDaGFuZ2VTZXRDYWxsZWQpLnRvQmVGYWxzeSgpO1xuICBleHBlY3QoZGVzY3JpYmVTdGFja3NJbnB1dCEpLnRvU3RyaWN0RXF1YWwoeyBTdGFja05hbWU6ICd3aXRob3V0ZXJyb3JzJyB9KTtcbiAgZXhwZWN0KGdldFRlbXBsYXRlSW5wdXQhKS50b1N0cmljdEVxdWFsKHsgU3RhY2tOYW1lOiAnd2l0aG91dGVycm9ycycsIFRlbXBsYXRlU3RhZ2U6ICdPcmlnaW5hbCcgfSk7XG59KTtcblxudGVzdCgnZGVwbG95IG5vdCBza2lwcGVkIGlmIHRlbXBsYXRlIGRpZCBub3QgY2hhbmdlIGJ1dCB0YWdzIGNoYW5nZWQnLCBhc3luYyAoKSA9PiB7XG4gIGNvbnN0IHNkayA9IG5ldyBNb2NrU0RLKCk7XG4gIGxldCBkZXNjcmliZVN0YWNrc0lucHV0OiBBV1MuQ2xvdWRGb3JtYXRpb24uRGVzY3JpYmVTdGFja3NJbnB1dDtcbiAgbGV0IGdldFRlbXBsYXRlSW5wdXQ6IEFXUy5DbG91ZEZvcm1hdGlvbi5HZXRUZW1wbGF0ZUlucHV0O1xuICBsZXQgY3JlYXRlQ2hhbmdlU2V0Q2FsbGVkID0gZmFsc2U7XG4gIGxldCBleGVjdXRlQ2hhbmdlU2V0Q2FsbGVkID0gZmFsc2U7XG4gIGxldCBkZXNjcmliZUNoYW5nZVNldENhbGxlZCA9IGZhbHNlO1xuXG4gIHNkay5zdHViQ2xvdWRGb3JtYXRpb24oe1xuICAgIGdldFRlbXBsYXRlKGlucHV0KSB7XG4gICAgICBnZXRUZW1wbGF0ZUlucHV0ID0gaW5wdXQ7XG4gICAgICByZXR1cm4ge1xuICAgICAgICBUZW1wbGF0ZUJvZHk6IEpTT04uc3RyaW5naWZ5KEZBS0VfVEVNUExBVEUpXG4gICAgICB9O1xuICAgIH0sXG4gICAgZGVzY3JpYmVTdGFja3MoaW5wdXQpIHtcbiAgICAgIGRlc2NyaWJlU3RhY2tzSW5wdXQgPSBpbnB1dDtcbiAgICAgIHJldHVybiB7XG4gICAgICAgIFN0YWNrczogW1xuICAgICAgICAgIHtcbiAgICAgICAgICAgIFN0YWNrTmFtZTogJ21vY2stc3RhY2stbmFtZScsXG4gICAgICAgICAgICBTdGFja0lkOiAnbW9jay1zdGFjay1pZCcsXG4gICAgICAgICAgICBDcmVhdGlvblRpbWU6IG5ldyBEYXRlKCksXG4gICAgICAgICAgICBTdGFja1N0YXR1czogJ0NSRUFURV9DT01QTEVURScsXG4gICAgICAgICAgICBUYWdzOiBbXG4gICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICBLZXk6ICdLZXknLFxuICAgICAgICAgICAgICAgIFZhbHVlOiAnVmFsdWUnXG4gICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBdXG4gICAgICAgICAgfVxuICAgICAgICBdXG4gICAgICB9O1xuICAgIH0sXG4gICAgY3JlYXRlQ2hhbmdlU2V0KCkge1xuICAgICAgY3JlYXRlQ2hhbmdlU2V0Q2FsbGVkID0gdHJ1ZTtcbiAgICAgIHJldHVybiB7IH07XG4gICAgfSxcbiAgICBleGVjdXRlQ2hhbmdlU2V0KCkge1xuICAgICAgZXhlY3V0ZUNoYW5nZVNldENhbGxlZCA9IHRydWU7XG4gICAgICByZXR1cm4geyB9O1xuICAgIH0sXG4gICAgZGVzY3JpYmVDaGFuZ2VTZXQoKSB7XG4gICAgICBkZXNjcmliZUNoYW5nZVNldENhbGxlZCA9IHRydWU7XG4gICAgICByZXR1cm4ge1xuICAgICAgICBTdGF0dXM6ICdDUkVBVEVfQ09NUExFVEUnLFxuICAgICAgICBDaGFuZ2VzOiBbXSxcbiAgICAgIH07XG4gICAgfVxuICB9KTtcblxuICBhd2FpdCBkZXBsb3lTdGFjayh7XG4gICAgc3RhY2s6IEZBS0VfU1RBQ0ssXG4gICAgc2RrLFxuICAgIHRhZ3M6IFtcbiAgICAgIHtcbiAgICAgICAgS2V5OiAnS2V5JyxcbiAgICAgICAgVmFsdWU6ICdOZXdWYWx1ZSdcbiAgICAgIH1cbiAgICBdXG4gIH0pO1xuXG4gIGV4cGVjdChjcmVhdGVDaGFuZ2VTZXRDYWxsZWQpLnRvQmVUcnV0aHkoKTtcbiAgZXhwZWN0KGV4ZWN1dGVDaGFuZ2VTZXRDYWxsZWQpLnRvQmVUcnV0aHkoKTtcbiAgZXhwZWN0KGRlc2NyaWJlQ2hhbmdlU2V0Q2FsbGVkKS50b0JlVHJ1dGh5KCk7XG4gIGV4cGVjdChkZXNjcmliZVN0YWNrc0lucHV0ISkudG9TdHJpY3RFcXVhbCh7IFN0YWNrTmFtZTogXCJ3aXRob3V0ZXJyb3JzXCIgfSk7XG4gIGV4cGVjdChnZXRUZW1wbGF0ZUlucHV0ISkudG9TdHJpY3RFcXVhbCh7IFN0YWNrTmFtZTogJ3dpdGhvdXRlcnJvcnMnLCBUZW1wbGF0ZVN0YWdlOiAnT3JpZ2luYWwnIH0pO1xufSk7XG5cbnRlc3QoJ2RlcGxveSBub3Qgc2tpcHBlZCBpZiB0ZW1wbGF0ZSBkaWQgbm90IGNoYW5nZSBidXQgb25lIHRhZyByZW1vdmVkJywgYXN5bmMgKCkgPT4ge1xuICBjb25zdCBzZGsgPSBuZXcgTW9ja1NESygpO1xuICBsZXQgZGVzY3JpYmVTdGFja3NJbnB1dDogQVdTLkNsb3VkRm9ybWF0aW9uLkRlc2NyaWJlU3RhY2tzSW5wdXQ7XG4gIGxldCBnZXRUZW1wbGF0ZUlucHV0OiBBV1MuQ2xvdWRGb3JtYXRpb24uR2V0VGVtcGxhdGVJbnB1dDtcbiAgbGV0IGNyZWF0ZUNoYW5nZVNldENhbGxlZCA9IGZhbHNlO1xuICBsZXQgZXhlY3V0ZUNoYW5nZVNldENhbGxlZCA9IGZhbHNlO1xuICBsZXQgZGVzY3JpYmVDaGFuZ2VTZXRDYWxsZWQgPSBmYWxzZTtcblxuICBzZGsuc3R1YkNsb3VkRm9ybWF0aW9uKHtcbiAgICBnZXRUZW1wbGF0ZShpbnB1dCkge1xuICAgICAgZ2V0VGVtcGxhdGVJbnB1dCA9IGlucHV0O1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgVGVtcGxhdGVCb2R5OiBKU09OLnN0cmluZ2lmeShGQUtFX1RFTVBMQVRFKVxuICAgICAgfTtcbiAgICB9LFxuICAgIGRlc2NyaWJlU3RhY2tzKGlucHV0KSB7XG4gICAgICBkZXNjcmliZVN0YWNrc0lucHV0ID0gaW5wdXQ7XG4gICAgICByZXR1cm4ge1xuICAgICAgICBTdGFja3M6IFtcbiAgICAgICAgICB7XG4gICAgICAgICAgICBTdGFja05hbWU6ICdtb2NrLXN0YWNrLW5hbWUnLFxuICAgICAgICAgICAgU3RhY2tJZDogJ21vY2stc3RhY2staWQnLFxuICAgICAgICAgICAgQ3JlYXRpb25UaW1lOiBuZXcgRGF0ZSgpLFxuICAgICAgICAgICAgU3RhY2tTdGF0dXM6ICdDUkVBVEVfQ09NUExFVEUnLFxuICAgICAgICAgICAgVGFnczogW1xuICAgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgS2V5OiAnS2V5MScsXG4gICAgICAgICAgICAgICAgVmFsdWU6ICdWYWx1ZTEnXG4gICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICBLZXk6ICdLZXkyJyxcbiAgICAgICAgICAgICAgICBWYWx1ZTogJ1ZhbHVlMidcbiAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIF1cbiAgICAgICAgICB9XG4gICAgICAgIF1cbiAgICAgIH07XG4gICAgfSxcbiAgICBjcmVhdGVDaGFuZ2VTZXQoKSB7XG4gICAgICBjcmVhdGVDaGFuZ2VTZXRDYWxsZWQgPSB0cnVlO1xuICAgICAgcmV0dXJuIHsgfTtcbiAgICB9LFxuICAgIGV4ZWN1dGVDaGFuZ2VTZXQoKSB7XG4gICAgICBleGVjdXRlQ2hhbmdlU2V0Q2FsbGVkID0gdHJ1ZTtcbiAgICAgIHJldHVybiB7IH07XG4gICAgfSxcbiAgICBkZXNjcmliZUNoYW5nZVNldCgpIHtcbiAgICAgIGRlc2NyaWJlQ2hhbmdlU2V0Q2FsbGVkID0gdHJ1ZTtcbiAgICAgIHJldHVybiB7XG4gICAgICAgIFN0YXR1czogJ0NSRUFURV9DT01QTEVURScsXG4gICAgICAgIENoYW5nZXM6IFtdLFxuICAgICAgfTtcbiAgICB9XG4gIH0pO1xuXG4gIGF3YWl0IGRlcGxveVN0YWNrKHtcbiAgICBzdGFjazogRkFLRV9TVEFDSyxcbiAgICBzZGssXG4gICAgdGFnczogW1xuICAgICAge1xuICAgICAgICBLZXk6ICdLZXkxJyxcbiAgICAgICAgVmFsdWU6ICdWYWx1ZTEnXG4gICAgICB9XG4gICAgXVxuICB9KTtcblxuICBleHBlY3QoY3JlYXRlQ2hhbmdlU2V0Q2FsbGVkKS50b0JlVHJ1dGh5KCk7XG4gIGV4cGVjdChleGVjdXRlQ2hhbmdlU2V0Q2FsbGVkKS50b0JlVHJ1dGh5KCk7XG4gIGV4cGVjdChkZXNjcmliZUNoYW5nZVNldENhbGxlZCkudG9CZVRydXRoeSgpO1xuICBleHBlY3QoZGVzY3JpYmVTdGFja3NJbnB1dCEpLnRvU3RyaWN0RXF1YWwoeyBTdGFja05hbWU6IFwid2l0aG91dGVycm9yc1wiIH0pO1xuICBleHBlY3QoZ2V0VGVtcGxhdGVJbnB1dCEpLnRvU3RyaWN0RXF1YWwoeyBTdGFja05hbWU6ICd3aXRob3V0ZXJyb3JzJywgVGVtcGxhdGVTdGFnZTogJ09yaWdpbmFsJyB9KTtcbn0pO1xuXG50ZXN0KCdkZXBsb3kgbm90IHNraXBwZWQgaWYgdGVtcGxhdGUgZGlkIG5vdCBjaGFuZ2UgYW5kIC0tZm9yY2UgaXMgYXBwbGllZCcsIGFzeW5jICgpID0+IHtcbiAgY29uc3Qgc2RrID0gbmV3IE1vY2tTREsoKTtcbiAgbGV0IGRlc2NyaWJlU3RhY2tzSW5wdXQ6IEFXUy5DbG91ZEZvcm1hdGlvbi5EZXNjcmliZVN0YWNrc0lucHV0O1xuICBsZXQgZ2V0VGVtcGxhdGVJbnB1dDogQVdTLkNsb3VkRm9ybWF0aW9uLkdldFRlbXBsYXRlSW5wdXQ7XG4gIGxldCBjcmVhdGVDaGFuZ2VTZXRDYWxsZWQgPSBmYWxzZTtcbiAgbGV0IGV4ZWN1dGVDaGFuZ2VTZXRDYWxsZWQgPSBmYWxzZTtcbiAgbGV0IGRlc2NyaWJlQ2hhbmdlU2V0Q2FsbGVkID0gZmFsc2U7XG5cbiAgc2RrLnN0dWJDbG91ZEZvcm1hdGlvbih7XG4gICAgZ2V0VGVtcGxhdGUoaW5wdXQpIHtcbiAgICAgIGdldFRlbXBsYXRlSW5wdXQgPSBpbnB1dDtcbiAgICAgIHJldHVybiB7XG4gICAgICAgIFRlbXBsYXRlQm9keTogSlNPTi5zdHJpbmdpZnkoRkFLRV9URU1QTEFURSlcbiAgICAgIH07XG4gICAgfSxcbiAgICBkZXNjcmliZVN0YWNrcyhpbnB1dCkge1xuICAgICAgZGVzY3JpYmVTdGFja3NJbnB1dCA9IGlucHV0O1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgU3RhY2tzOiBbXG4gICAgICAgICAge1xuICAgICAgICAgICAgU3RhY2tOYW1lOiAnbW9jay1zdGFjay1uYW1lJyxcbiAgICAgICAgICAgIFN0YWNrSWQ6ICdtb2NrLXN0YWNrLWlkJyxcbiAgICAgICAgICAgIENyZWF0aW9uVGltZTogbmV3IERhdGUoKSxcbiAgICAgICAgICAgIFN0YWNrU3RhdHVzOiAnQ1JFQVRFX0NPTVBMRVRFJ1xuICAgICAgICAgIH1cbiAgICAgICAgXVxuICAgICAgfTtcbiAgICB9LFxuICAgIGNyZWF0ZUNoYW5nZVNldCgpIHtcbiAgICAgIGNyZWF0ZUNoYW5nZVNldENhbGxlZCA9IHRydWU7XG4gICAgICByZXR1cm4geyB9O1xuICAgIH0sXG4gICAgZXhlY3V0ZUNoYW5nZVNldCgpIHtcbiAgICAgIGV4ZWN1dGVDaGFuZ2VTZXRDYWxsZWQgPSB0cnVlO1xuICAgICAgcmV0dXJuIHsgfTtcbiAgICB9LFxuICAgIGRlc2NyaWJlQ2hhbmdlU2V0KCkge1xuICAgICAgZGVzY3JpYmVDaGFuZ2VTZXRDYWxsZWQgPSB0cnVlO1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgU3RhdHVzOiAnQ1JFQVRFX0NPTVBMRVRFJyxcbiAgICAgICAgQ2hhbmdlczogW10sXG4gICAgICB9O1xuICAgIH1cbiAgfSk7XG5cbiAgYXdhaXQgZGVwbG95U3RhY2soe1xuICAgIHN0YWNrOiBGQUtFX1NUQUNLLFxuICAgIHNkayxcbiAgICBmb3JjZTogdHJ1ZVxuICB9KTtcblxuICBleHBlY3QoY3JlYXRlQ2hhbmdlU2V0Q2FsbGVkKS50b0JlVHJ1dGh5KCk7XG4gIGV4cGVjdChleGVjdXRlQ2hhbmdlU2V0Q2FsbGVkKS50b0JlVHJ1dGh5KCk7XG4gIGV4cGVjdChkZXNjcmliZUNoYW5nZVNldENhbGxlZCkudG9CZVRydXRoeSgpO1xuICBleHBlY3QoZ2V0VGVtcGxhdGVJbnB1dCEpLnRvQmVVbmRlZmluZWQoKTtcbiAgZXhwZWN0KGRlc2NyaWJlU3RhY2tzSW5wdXQhKS50b1N0cmljdEVxdWFsKHsgU3RhY2tOYW1lOiBcIndpdGhvdXRlcnJvcnNcIiB9KTtcbn0pO1xuXG50ZXN0KCdkZXBsb3kgbm90IHNraXBwZWQgaWYgdGVtcGxhdGUgY2hhbmdlZCcsIGFzeW5jICgpID0+IHtcbiAgY29uc3Qgc2RrID0gbmV3IE1vY2tTREsoKTtcbiAgbGV0IGRlc2NyaWJlU3RhY2tzSW5wdXQ6IEFXUy5DbG91ZEZvcm1hdGlvbi5EZXNjcmliZVN0YWNrc0lucHV0O1xuICBsZXQgZ2V0VGVtcGxhdGVJbnB1dDogQVdTLkNsb3VkRm9ybWF0aW9uLkdldFRlbXBsYXRlSW5wdXQ7XG4gIGxldCBjcmVhdGVDaGFuZ2VTZXRDYWxsZWQgPSBmYWxzZTtcbiAgbGV0IGV4ZWN1dGVDaGFuZ2VTZXRDYWxsZWQgPSBmYWxzZTtcbiAgbGV0IGRlc2NyaWJlQ2hhbmdlU2V0Q2FsbGVkID0gZmFsc2U7XG5cbiAgc2RrLnN0dWJDbG91ZEZvcm1hdGlvbih7XG4gICAgZ2V0VGVtcGxhdGUoaW5wdXQpIHtcbiAgICAgIGdldFRlbXBsYXRlSW5wdXQgPSBpbnB1dDtcbiAgICAgIHJldHVybiB7XG4gICAgICAgIFRlbXBsYXRlQm9keTogSlNPTi5zdHJpbmdpZnkoeyBjaGFuZ2VkOiAxMjMgfSlcbiAgICAgIH07XG4gICAgfSxcbiAgICBkZXNjcmliZVN0YWNrcyhpbnB1dCkge1xuICAgICAgZGVzY3JpYmVTdGFja3NJbnB1dCA9IGlucHV0O1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgU3RhY2tzOiBbXG4gICAgICAgICAge1xuICAgICAgICAgICAgU3RhY2tOYW1lOiAnbW9jay1zdGFjay1uYW1lJyxcbiAgICAgICAgICAgIFN0YWNrSWQ6ICdtb2NrLXN0YWNrLWlkJyxcbiAgICAgICAgICAgIENyZWF0aW9uVGltZTogbmV3IERhdGUoKSxcbiAgICAgICAgICAgIFN0YWNrU3RhdHVzOiAnQ1JFQVRFX0NPTVBMRVRFJ1xuICAgICAgICAgIH1cbiAgICAgICAgXVxuICAgICAgfTtcbiAgICB9LFxuICAgIGNyZWF0ZUNoYW5nZVNldCgpIHtcbiAgICAgIGNyZWF0ZUNoYW5nZVNldENhbGxlZCA9IHRydWU7XG4gICAgICByZXR1cm4geyB9O1xuICAgIH0sXG4gICAgZXhlY3V0ZUNoYW5nZVNldCgpIHtcbiAgICAgIGV4ZWN1dGVDaGFuZ2VTZXRDYWxsZWQgPSB0cnVlO1xuICAgICAgcmV0dXJuIHsgfTtcbiAgICB9LFxuICAgIGRlc2NyaWJlQ2hhbmdlU2V0KCkge1xuICAgICAgZGVzY3JpYmVDaGFuZ2VTZXRDYWxsZWQgPSB0cnVlO1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgU3RhdHVzOiAnQ1JFQVRFX0NPTVBMRVRFJyxcbiAgICAgICAgQ2hhbmdlczogW10sXG4gICAgICB9O1xuICAgIH1cbiAgfSk7XG5cbiAgYXdhaXQgZGVwbG95U3RhY2soe1xuICAgIHN0YWNrOiBGQUtFX1NUQUNLLFxuICAgIHNka1xuICB9KTtcblxuICBleHBlY3QoY3JlYXRlQ2hhbmdlU2V0Q2FsbGVkKS50b0JlVHJ1dGh5KCk7XG4gIGV4cGVjdChleGVjdXRlQ2hhbmdlU2V0Q2FsbGVkKS50b0JlVHJ1dGh5KCk7XG4gIGV4cGVjdChkZXNjcmliZUNoYW5nZVNldENhbGxlZCkudG9CZVRydXRoeSgpO1xuICBleHBlY3QoZGVzY3JpYmVTdGFja3NJbnB1dCEpLnRvU3RyaWN0RXF1YWwoeyBTdGFja05hbWU6IFwid2l0aG91dGVycm9yc1wiIH0pO1xuICBleHBlY3QoZ2V0VGVtcGxhdGVJbnB1dCEpLnRvU3RyaWN0RXF1YWwoeyBTdGFja05hbWU6ICd3aXRob3V0ZXJyb3JzJywgVGVtcGxhdGVTdGFnZTogJ09yaWdpbmFsJyB9KTtcbn0pO1xuIl19