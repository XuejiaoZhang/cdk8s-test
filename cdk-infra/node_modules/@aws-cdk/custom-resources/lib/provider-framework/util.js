"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const core_1 = require("@aws-cdk/core");
const DEFAULT_TIMEOUT = core_1.Duration.minutes(30);
const DEFAULT_INTERVAL = core_1.Duration.seconds(5);
function calculateRetryPolicy(props = {}) {
    const totalTimeout = props.totalTimeout || DEFAULT_TIMEOUT;
    const interval = props.queryInterval || DEFAULT_INTERVAL;
    const maxAttempts = totalTimeout.toSeconds() / interval.toSeconds();
    if (Math.round(maxAttempts) !== maxAttempts) {
        throw new Error(`Cannot determine retry count since totalTimeout=${totalTimeout.toSeconds()}s is not integrally dividable by queryInterval=${interval.toSeconds()}s`);
    }
    return {
        maxAttempts,
        interval,
        backoffRate: 1
    };
}
exports.calculateRetryPolicy = calculateRetryPolicy;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidXRpbC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbInV0aWwudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7QUFDQSx3Q0FBeUM7QUFFekMsTUFBTSxlQUFlLEdBQUcsZUFBUSxDQUFDLE9BQU8sQ0FBQyxFQUFFLENBQUMsQ0FBQztBQUM3QyxNQUFNLGdCQUFnQixHQUFHLGVBQVEsQ0FBQyxPQUFPLENBQUMsQ0FBQyxDQUFDLENBQUM7QUFFN0MsU0FBZ0Isb0JBQW9CLENBQUMsUUFBK0QsRUFBRztJQUNyRyxNQUFNLFlBQVksR0FBRyxLQUFLLENBQUMsWUFBWSxJQUFJLGVBQWUsQ0FBQztJQUMzRCxNQUFNLFFBQVEsR0FBRyxLQUFLLENBQUMsYUFBYSxJQUFJLGdCQUFnQixDQUFDO0lBQ3pELE1BQU0sV0FBVyxHQUFHLFlBQVksQ0FBQyxTQUFTLEVBQUUsR0FBRyxRQUFRLENBQUMsU0FBUyxFQUFFLENBQUM7SUFFcEUsSUFBSSxJQUFJLENBQUMsS0FBSyxDQUFDLFdBQVcsQ0FBQyxLQUFLLFdBQVcsRUFBRTtRQUMzQyxNQUFNLElBQUksS0FBSyxDQUFDLG1EQUFtRCxZQUFZLENBQUMsU0FBUyxFQUFFLGtEQUFrRCxRQUFRLENBQUMsU0FBUyxFQUFFLEdBQUcsQ0FBQyxDQUFDO0tBQ3ZLO0lBRUQsT0FBTztRQUNMLFdBQVc7UUFDWCxRQUFRO1FBQ1IsV0FBVyxFQUFFLENBQUM7S0FDZixDQUFDO0FBQ0osQ0FBQztBQWRELG9EQWNDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0ICogYXMgc2ZuIGZyb20gJ0Bhd3MtY2RrL2F3cy1zdGVwZnVuY3Rpb25zJztcbmltcG9ydCB7IER1cmF0aW9uIH0gZnJvbSAnQGF3cy1jZGsvY29yZSc7XG5cbmNvbnN0IERFRkFVTFRfVElNRU9VVCA9IER1cmF0aW9uLm1pbnV0ZXMoMzApO1xuY29uc3QgREVGQVVMVF9JTlRFUlZBTCA9IER1cmF0aW9uLnNlY29uZHMoNSk7XG5cbmV4cG9ydCBmdW5jdGlvbiBjYWxjdWxhdGVSZXRyeVBvbGljeShwcm9wczogeyB0b3RhbFRpbWVvdXQ/OiBEdXJhdGlvbiwgcXVlcnlJbnRlcnZhbD86IER1cmF0aW9uIH0gPSB7IH0pOiBzZm4uUmV0cnlQcm9wcyB7XG4gIGNvbnN0IHRvdGFsVGltZW91dCA9IHByb3BzLnRvdGFsVGltZW91dCB8fCBERUZBVUxUX1RJTUVPVVQ7XG4gIGNvbnN0IGludGVydmFsID0gcHJvcHMucXVlcnlJbnRlcnZhbCB8fCBERUZBVUxUX0lOVEVSVkFMO1xuICBjb25zdCBtYXhBdHRlbXB0cyA9IHRvdGFsVGltZW91dC50b1NlY29uZHMoKSAvIGludGVydmFsLnRvU2Vjb25kcygpO1xuXG4gIGlmIChNYXRoLnJvdW5kKG1heEF0dGVtcHRzKSAhPT0gbWF4QXR0ZW1wdHMpIHtcbiAgICB0aHJvdyBuZXcgRXJyb3IoYENhbm5vdCBkZXRlcm1pbmUgcmV0cnkgY291bnQgc2luY2UgdG90YWxUaW1lb3V0PSR7dG90YWxUaW1lb3V0LnRvU2Vjb25kcygpfXMgaXMgbm90IGludGVncmFsbHkgZGl2aWRhYmxlIGJ5IHF1ZXJ5SW50ZXJ2YWw9JHtpbnRlcnZhbC50b1NlY29uZHMoKX1zYCk7XG4gIH1cblxuICByZXR1cm4ge1xuICAgIG1heEF0dGVtcHRzLFxuICAgIGludGVydmFsLFxuICAgIGJhY2tvZmZSYXRlOiAxXG4gIH07XG59XG4iXX0=