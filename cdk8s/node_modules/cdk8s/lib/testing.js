"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const fs = require("fs");
const path = require("path");
const os = require("os");
const lib_1 = require("../lib");
const YAML = require("yaml");
/**
 * Testing utilities for cdk8s applications.
 */
class Testing {
    /**
     * Returns an app for testing with the following properties:
     * - Output directory is a temp dir.
     */
    static app() {
        const outdir = fs.mkdtempSync(path.join(os.tmpdir(), 'cdk8s.outdir.'));
        return new lib_1.App({ outdir });
    }
    /**
     * Returns the Kubernetes manifest synthesized from this chart.
     */
    static synth(chart) {
        const app = chart.node.root;
        app.synth();
        const filePath = path.join(app.outdir, chart.manifestFile);
        return YAML.parseAllDocuments(fs.readFileSync(filePath, 'utf-8')).map((doc) => doc.toJSON());
    }
    /* istanbul ignore next */
    constructor() {
        return;
    }
}
exports.Testing = Testing;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidGVzdGluZy5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbInRlc3RpbmcudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7QUFBQSx5QkFBMEI7QUFDMUIsNkJBQThCO0FBQzlCLHlCQUEwQjtBQUMxQixnQ0FBb0M7QUFDcEMsNkJBQTZCO0FBRTdCOztHQUVHO0FBQ0gsTUFBYSxPQUFPO0lBQ2xCOzs7T0FHRztJQUNJLE1BQU0sQ0FBQyxHQUFHO1FBQ2YsTUFBTSxNQUFNLEdBQUcsRUFBRSxDQUFDLFdBQVcsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLEVBQUUsQ0FBQyxNQUFNLEVBQUUsRUFBRSxlQUFlLENBQUMsQ0FBQyxDQUFDO1FBQ3ZFLE9BQU8sSUFBSSxTQUFHLENBQUMsRUFBRSxNQUFNLEVBQUUsQ0FBQyxDQUFDO0lBQzdCLENBQUM7SUFFRDs7T0FFRztJQUNJLE1BQU0sQ0FBQyxLQUFLLENBQUMsS0FBWTtRQUM5QixNQUFNLEdBQUcsR0FBRyxLQUFLLENBQUMsSUFBSSxDQUFDLElBQVcsQ0FBQztRQUNuQyxHQUFHLENBQUMsS0FBSyxFQUFFLENBQUM7UUFFWixNQUFNLFFBQVEsR0FBRyxJQUFJLENBQUMsSUFBSSxDQUFDLEdBQUcsQ0FBQyxNQUFNLEVBQUUsS0FBSyxDQUFDLFlBQVksQ0FBQyxDQUFDO1FBQzNELE9BQU8sSUFBSSxDQUFDLGlCQUFpQixDQUFDLEVBQUUsQ0FBQyxZQUFZLENBQUMsUUFBUSxFQUFFLE9BQU8sQ0FBQyxDQUFDLENBQUMsR0FBRyxDQUFDLENBQUMsR0FBUSxFQUFFLEVBQUUsQ0FBQyxHQUFHLENBQUMsTUFBTSxFQUFFLENBQUMsQ0FBQztJQUNwRyxDQUFDO0lBRUQsMEJBQTBCO0lBQzFCO1FBQ0UsT0FBTztJQUNULENBQUM7Q0FDRjtBQXpCRCwwQkF5QkMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgZnMgPSByZXF1aXJlKCdmcycpO1xuaW1wb3J0IHBhdGggPSByZXF1aXJlKCdwYXRoJyk7XG5pbXBvcnQgb3MgPSByZXF1aXJlKCdvcycpO1xuaW1wb3J0IHsgQXBwLCBDaGFydCB9IGZyb20gJy4uL2xpYic7XG5pbXBvcnQgKiBhcyBZQU1MIGZyb20gJ3lhbWwnO1xuXG4vKipcbiAqIFRlc3RpbmcgdXRpbGl0aWVzIGZvciBjZGs4cyBhcHBsaWNhdGlvbnMuXG4gKi9cbmV4cG9ydCBjbGFzcyBUZXN0aW5nIHtcbiAgLyoqXG4gICAqIFJldHVybnMgYW4gYXBwIGZvciB0ZXN0aW5nIHdpdGggdGhlIGZvbGxvd2luZyBwcm9wZXJ0aWVzOlxuICAgKiAtIE91dHB1dCBkaXJlY3RvcnkgaXMgYSB0ZW1wIGRpci5cbiAgICovXG4gIHB1YmxpYyBzdGF0aWMgYXBwKCkge1xuICAgIGNvbnN0IG91dGRpciA9IGZzLm1rZHRlbXBTeW5jKHBhdGguam9pbihvcy50bXBkaXIoKSwgJ2NkazhzLm91dGRpci4nKSk7XG4gICAgcmV0dXJuIG5ldyBBcHAoeyBvdXRkaXIgfSk7XG4gIH1cblxuICAvKipcbiAgICogUmV0dXJucyB0aGUgS3ViZXJuZXRlcyBtYW5pZmVzdCBzeW50aGVzaXplZCBmcm9tIHRoaXMgY2hhcnQuXG4gICAqL1xuICBwdWJsaWMgc3RhdGljIHN5bnRoKGNoYXJ0OiBDaGFydCkge1xuICAgIGNvbnN0IGFwcCA9IGNoYXJ0Lm5vZGUucm9vdCBhcyBBcHA7XG4gICAgYXBwLnN5bnRoKCk7XG4gICAgXG4gICAgY29uc3QgZmlsZVBhdGggPSBwYXRoLmpvaW4oYXBwLm91dGRpciwgY2hhcnQubWFuaWZlc3RGaWxlKTtcbiAgICByZXR1cm4gWUFNTC5wYXJzZUFsbERvY3VtZW50cyhmcy5yZWFkRmlsZVN5bmMoZmlsZVBhdGgsICd1dGYtOCcpKS5tYXAoKGRvYzogYW55KSA9PiBkb2MudG9KU09OKCkpO1xuICB9XG5cbiAgLyogaXN0YW5idWwgaWdub3JlIG5leHQgKi9cbiAgcHJpdmF0ZSBjb25zdHJ1Y3RvcigpIHtcbiAgICByZXR1cm47XG4gIH1cbn1cbiJdfQ==